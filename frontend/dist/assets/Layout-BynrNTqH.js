import{_ as ee,u as se,n as te,p as ne,o as l,c as v,b as t,w as s,a as c,e as u,q as oe,r,d as ae,f as O,s as _,v as le,x as w,F as C,y as A,i as f,t as g,z as re,A as ie,B as ue,K as de,C as me,D as k,G as ce,E as z}from"./index-DDrUN6p6.js";import{u as pe}from"./tabs-DyOH422c.js";import{a as _e}from"./auth-CeISuAVf.js";import"./index-B2NntqTq.js";import"./index-D5GkNzM3.js";const fe={class:"layout-container"},be={class:"logo"},ye={class:"main-container"},ge={class:"breadcrumb"},he={class:"user-info"},ve={class:"user-avatar"},we={class:"user-name"},ke={class:"tabs-container"},xe={__name:"Layout",setup(Te){const b=oe(),x=ae(),d=se(),m=pe(),D=k(()=>b.path),B=k(()=>b.meta.title),F={"/dashboard":"dashboard","/green-identify/pending":"green-identify-pending","/green-identify/completed":"green-identify-completed","/green-identify/archived":"green-identify-archived","/green-identify/query":"green-identify-query","/system/user":"system-user","/system/role":"system-role","/system/org":"system-org","/workflow/management":"workflow-management","/workflow/instances":"workflow-instances"},I=a=>{var n,o;const e=F[a];return((n=d.permissions)==null?void 0:n.includes(e))||((o=d.user)==null?void 0:o.is_superuser)},L=k(()=>[{path:"/green-identify/pending",label:"待办任务",permission:"green-identify-pending"},{path:"/green-identify/completed",label:"已办任务",permission:"green-identify-completed"},{path:"/green-identify/archived",label:"办结任务",permission:"green-identify-archived"},{path:"/green-identify/query",label:"综合查询",permission:"green-identify-query"}].filter(e=>{var n,o;return((n=d.permissions)==null?void 0:n.includes(e.permission))||((o=d.user)==null?void 0:o.is_superuser)})),M=k(()=>[{path:"/system/user",label:"用户管理",permission:"system-user"},{path:"/system/role",label:"角色管理",permission:"system-role"},{path:"/system/org",label:"机构管理",permission:"system-org"}].filter(e=>{var n,o;return((n=d.permissions)==null?void 0:n.includes(e.permission))||((o=d.user)==null?void 0:o.is_superuser)})),R=k(()=>[{path:"/workflow/management",label:"流程管理",permission:"workflow-management"},{path:"/workflow/instances",label:"流程实例",permission:"workflow-instances"},{path:"/workflow/variables",label:"流程变量",permission:"workflow-variables"}].filter(e=>{var n,o;return((n=d.permissions)==null?void 0:n.includes(e.permission))||((o=d.user)==null?void 0:o.is_superuser)}));te(()=>b.path,a=>{a&&!b.meta.hidden&&m.addTab(b)},{immediate:!0});const K=a=>{m.removeTab(a),m.activeTab!==a&&x.push(m.activeTab)},U=a=>{const e=a.props.name,[n,o]=e.split("?");if(o){const h=new URLSearchParams(o),q=Object.fromEntries(h);x.push({path:n,query:q})}else x.push(n)},j=(a,e)=>{switch(a){case"close":m.removeTab(e);break;case"closeOthers":m.closeOtherTabs(e);break;case"closeLeft":m.closeLeftTabs(e);break;case"closeRight":m.closeRightTabs(e);break;case"closeAll":m.closeAllTabs();break}},G=async()=>{try{await ce.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await _e(),d.logout(),m.closeAllTabs(),z.success("退出成功"),x.push("/login")}catch(a){a!=="cancel"&&z.error("退出失败")}};return ne(()=>{b.path&&!b.meta.hidden&&m.addTab(b)}),(a,e)=>{const n=r("el-icon"),o=r("el-menu-item"),h=r("el-sub-menu"),q=r("el-menu"),H=r("el-aside"),S=r("el-breadcrumb-item"),J=r("el-breadcrumb"),Q=r("el-avatar"),y=r("el-dropdown-item"),V=r("el-dropdown-menu"),E=r("el-dropdown"),W=r("el-header"),X=r("el-tab-pane"),Y=r("el-tabs"),Z=r("router-view"),$=r("el-main");return l(),v("div",fe,[t(H,{width:"220px",class:"sidebar"},{default:s(()=>[c("div",be,[t(n,{size:32,color:"#fff"},{default:s(()=>[t(u(O))]),_:1}),e[1]||(e[1]=c("span",null,"绿色金融",-1))]),t(q,{"default-active":D.value,collapse:!1,"unique-opened":!0,router:"","background-color":"#0A6633","text-color":"#ffffff","active-text-color":"#4CAF50"},{default:s(()=>{var i,T,P,N;return[I("/dashboard")||(i=u(d).user)!=null&&i.is_superuser?(l(),_(o,{key:0,index:"/dashboard"},{default:s(()=>[t(n,null,{default:s(()=>[t(u(le))]),_:1}),e[2]||(e[2]=c("span",null,"首页",-1))]),_:1})):w("",!0),L.value.length>0||(T=u(d).user)!=null&&T.is_superuser?(l(),_(h,{key:1,index:"green-identify"},{title:s(()=>[t(n,null,{default:s(()=>[t(u(O))]),_:1}),e[3]||(e[3]=c("span",null,"绿色认定",-1))]),default:s(()=>[(l(!0),v(C,null,A(L.value,p=>(l(),_(o,{key:p.path,index:p.path},{default:s(()=>[f(g(p.label),1)]),_:2},1032,["index"]))),128))]),_:1})):w("",!0),M.value.length>0||(P=u(d).user)!=null&&P.is_superuser?(l(),_(h,{key:2,index:"system"},{title:s(()=>[t(n,null,{default:s(()=>[t(u(re))]),_:1}),e[4]||(e[4]=c("span",null,"系统管理",-1))]),default:s(()=>[(l(!0),v(C,null,A(M.value,p=>(l(),_(o,{key:p.path,index:p.path},{default:s(()=>[f(g(p.label),1)]),_:2},1032,["index"]))),128))]),_:1})):w("",!0),R.value.length>0||(N=u(d).user)!=null&&N.is_superuser?(l(),_(h,{key:3,index:"workflow"},{title:s(()=>[t(n,null,{default:s(()=>[t(u(ie))]),_:1}),e[5]||(e[5]=c("span",null,"流程管理",-1))]),default:s(()=>[(l(!0),v(C,null,A(R.value,p=>(l(),_(o,{key:p.path,index:p.path},{default:s(()=>[f(g(p.label),1)]),_:2},1032,["index"]))),128))]),_:1})):w("",!0)]}),_:1},8,["default-active"])]),_:1}),c("div",ye,[t(W,{class:"header"},{default:s(()=>[c("div",ge,[t(J,{separator:"/"},{default:s(()=>[t(S,null,{default:s(()=>[...e[6]||(e[6]=[f("首页",-1)])]),_:1}),B.value?(l(),_(S,{key:0},{default:s(()=>[f(g(B.value),1)]),_:1})):w("",!0)]),_:1})]),c("div",he,[t(E,null,{dropdown:s(()=>[t(V,null,{default:s(()=>[t(y,{onClick:G},{default:s(()=>[...e[7]||(e[7]=[f("退出登录",-1)])]),_:1})]),_:1})]),default:s(()=>{var i;return[c("div",ve,[t(Q,{size:32,icon:u(ue)},null,8,["icon"]),c("span",we,g((i=u(d).user)==null?void 0:i.real_name),1)])]}),_:1})])]),_:1}),c("div",ke,[t(Y,{modelValue:u(m).activeTab,"onUpdate:modelValue":e[0]||(e[0]=i=>u(m).activeTab=i),type:"card",closable:"",onTabRemove:K,onTabClick:U},{default:s(()=>[(l(!0),v(C,null,A(u(m).tabs,i=>(l(),_(X,{key:i.path,label:i.title,name:i.path},{label:s(()=>[t(E,{trigger:"contextmenu",onCommand:T=>j(T,i.path)},{dropdown:s(()=>[t(V,null,{default:s(()=>[t(y,{command:"close"},{default:s(()=>[...e[8]||(e[8]=[f("关闭",-1)])]),_:1}),t(y,{command:"closeOthers"},{default:s(()=>[...e[9]||(e[9]=[f("关闭其他",-1)])]),_:1}),t(y,{command:"closeLeft"},{default:s(()=>[...e[10]||(e[10]=[f("关闭左侧",-1)])]),_:1}),t(y,{command:"closeRight"},{default:s(()=>[...e[11]||(e[11]=[f("关闭右侧",-1)])]),_:1}),t(y,{command:"closeAll"},{default:s(()=>[...e[12]||(e[12]=[f("关闭全部",-1)])]),_:1})]),_:1})]),default:s(()=>[c("span",null,g(i.title),1)]),_:2},1032,["onCommand"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),t($,{class:"main-content"},{default:s(()=>[t(Z,null,{default:s(({Component:i})=>[(l(),_(de,null,[(l(),_(me(i),{key:u(b).fullPath}))],1024))]),_:1})]),_:1})])])}}},Me=ee(xe,[["__scopeId","data-v-2b43bde1"]]);export{Me as default};
