import{_ as le,s as ae,o as m,c as D,b as e,w as l,E as w,r as i,p as k,n as F,$ as te,a as d,F as A,y as N,i as M,a1 as oe,e as p,a8 as re,m as s,t as v,ax as $,an as ne,j as ie,k as I,am as se,z as de,L as ue}from"./index-D4Rku7DI.js";import{b as pe}from"./workflow-06JElo_C.js";import{r as U}from"./request-BnFmk4vl.js";import"./index-D5GkNzM3.js";function _e(_){return U.get("/workflow-variables",{params:_})}function ce(_){return U.post("/workflow-variables",_)}function fe(_,b){return U.put(`/workflow-variables/${_}`,b)}function me(_){return U.delete(`/workflow-variables/${_}`)}const ve={class:"workflow-variables"},be={class:"card-header"},ye={class:"header-left"},ge={class:"header-right"},we={class:"search-form-container"},ke={class:"workflow-name"},Ve={class:"variable-name"},he={class:"default-value"},xe={class:"action-buttons"},qe={class:"dialog-footer"},Ce={__name:"WorkflowVariables",setup(_){const b=k(!1),y=k(!1),h=k("add"),j=k(null),x=k([]),q=k([]),g=F({workflowType:""}),r=F({definition_id:"",variable_name:"",variable_key:"",variable_type:"string",default_value:"",description:"",required:!1}),L={definition_id:[{required:!0,message:"请选择流程类型",trigger:"change"}],variable_name:[{required:!0,message:"请输入变量名称",trigger:"blur"}],variable_key:[{required:!0,message:"请输入变量键",trigger:"blur"},{pattern:/^[a-zA-Z_][a-zA-Z0-9_]*$/,message:"变量键只能包含字母、数字和下划线，且必须以字母或下划线开头",trigger:"blur"}],variable_type:[{required:!0,message:"请选择变量类型",trigger:"change"}]},O=async()=>{try{const o=await pe({page:1,page_size:100}),a=new Map;o&&o.length>0?(o.forEach(n=>{(!a.has(n.name)||n.version>a.get(n.name).version)&&a.set(n.name,n)}),x.value=Array.from(a.values())):x.value=[]}catch(o){console.error("加载流程定义失败:",o)}},C=async()=>{b.value=!0;try{const o={};g.workflowType&&(o.definition_id=g.workflowType);const a=await _e(o);q.value=a||[]}catch(o){console.error("加载流程变量失败:",o),w.error("加载流程变量失败")}finally{b.value=!1}},R=()=>{h.value="add",Object.assign(r,{definition_id:g.workflowType||"",variable_name:"",variable_key:"",variable_type:"string",default_value:"",description:"",required:!1}),y.value=!0},S=o=>{h.value="edit",Object.assign(r,{id:o.id,definition_id:o.definition_id,variable_name:o.variable_name,variable_key:o.variable_key,variable_type:o.variable_type,default_value:o.default_value,description:o.description,required:o.required}),y.value=!0},W=o=>{ue.confirm("确定要删除该流程变量吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await me(o.id),w.success("删除成功"),C()}catch(a){console.error("删除失败:",a),w.error("删除失败")}}).catch(()=>{})},Z=async()=>{try{await j.value.validate();const o={...r};h.value==="edit"?(await fe(o.id,o),w.success("更新成功")):(await ce(o),w.success("创建成功")),y.value=!1,C()}catch(o){o!==!1&&(console.error("提交失败:",o),w.error("提交失败"))}},G=o=>({string:"字符串",number:"数字",boolean:"布尔值",array:"数组",object:"对象"})[o]||o,H=o=>({string:"primary",number:"success",boolean:"warning",array:"info",object:"danger"})[o]||"";return ae(()=>{O(),C()}),(o,a)=>{const n=i("el-icon"),T=i("el-tag"),V=i("el-button"),f=i("el-option"),B=i("el-select"),c=i("el-form-item"),E=i("el-form"),u=i("el-table-column"),J=i("el-table"),K=i("el-empty"),P=i("el-card"),z=i("el-input"),Q=i("el-switch"),X=i("el-dialog"),Y=te("loading");return m(),D("div",ve,[e(P,{shadow:"never"},{header:l(()=>[d("div",be,[d("div",ye,[e(n,{class:"header-icon",color:"#667eea"},{default:l(()=>[e(p(I))]),_:1}),a[10]||(a[10]=d("span",{class:"card-title"},"流程变量管理",-1)),e(T,{type:"info",size:"small"},{default:l(()=>[s(v(q.value.length)+" 个变量",1)]),_:1})]),d("div",ge,[e(V,{type:"primary",onClick:R},{default:l(()=>[e(n,null,{default:l(()=>[e(p(se))]),_:1}),a[11]||(a[11]=s(" 新建变量 ",-1))]),_:1})])])]),default:l(()=>[d("div",we,[e(E,{inline:!0,model:g,class:"search-form"},{default:l(()=>[e(c,{label:"流程类型"},{default:l(()=>[e(B,{modelValue:g.workflowType,"onUpdate:modelValue":a[0]||(a[0]=t=>g.workflowType=t),placeholder:"请选择流程类型",clearable:"",class:"modern-input",onChange:C},{default:l(()=>[(m(!0),D(A,null,N(x.value,t=>(m(),M(f,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),oe((m(),M(J,{data:q.value,stripe:"",class:"modern-table"},{default:l(()=>[e(u,{prop:"id",label:"ID",width:"80",align:"center"}),e(u,{prop:"definition_name",label:"流程类型",width:"200"},{default:l(({row:t})=>[d("div",ke,[e(n,null,{default:l(()=>[e(p(re))]),_:1}),s(" "+v(t.definition_name),1)])]),_:1}),e(u,{prop:"variable_name",label:"变量名称",width:"180"},{default:l(({row:t})=>[d("div",Ve,[e(n,null,{default:l(()=>[e(p($))]),_:1}),s(" "+v(t.variable_name),1)])]),_:1}),e(u,{prop:"variable_key",label:"变量键",width:"180"},{default:l(({row:t})=>[e(T,{type:"info",effect:"plain",size:"small"},{default:l(()=>[s(v(t.variable_key),1)]),_:2},1024)]),_:1}),e(u,{prop:"variable_type",label:"变量类型",width:"120",align:"center"},{default:l(({row:t})=>[e(T,{type:H(t.variable_type),effect:"plain",size:"small"},{default:l(()=>[s(v(G(t.variable_type)),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"default_value",label:"默认值",width:"150"},{default:l(({row:t})=>[d("div",he,v(t.default_value||"-"),1)]),_:1}),e(u,{prop:"description",label:"描述","min-width":"200","show-overflow-tooltip":""}),e(u,{prop:"required",label:"必填",width:"80",align:"center"},{default:l(({row:t})=>[e(T,{type:t.required?"success":"info",effect:"plain",size:"small"},{default:l(()=>[s(v(t.required?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),e(u,{label:"操作",width:"180",fixed:"right",align:"center"},{default:l(({row:t})=>[d("div",xe,[e(V,{type:"primary",link:"",size:"small",onClick:ee=>S(t)},{default:l(()=>[e(n,null,{default:l(()=>[e(p($))]),_:1}),a[12]||(a[12]=s(" 编辑 ",-1))]),_:1},8,["onClick"]),e(V,{type:"danger",link:"",size:"small",onClick:ee=>W(t)},{default:l(()=>[e(n,null,{default:l(()=>[e(p(ne))]),_:1}),a[13]||(a[13]=s(" 删除 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[Y,b.value]]),!b.value&&q.value.length===0?(m(),M(K,{key:0,description:"暂无流程变量"})):ie("",!0)]),_:1}),e(X,{modelValue:y.value,"onUpdate:modelValue":a[9]||(a[9]=t=>y.value=t),title:h.value==="add"?"新建流程变量":"编辑流程变量",width:"600px",class:"variable-dialog"},{footer:l(()=>[d("div",qe,[e(V,{onClick:a[8]||(a[8]=t=>y.value=!1)},{default:l(()=>[...a[14]||(a[14]=[s("取消",-1)])]),_:1}),e(V,{type:"primary",onClick:Z},{default:l(()=>[...a[15]||(a[15]=[s("确定",-1)])]),_:1})])]),default:l(()=>[e(E,{model:r,rules:L,ref_key:"variableFormRef",ref:j,"label-width":"100px",class:"variable-form"},{default:l(()=>[e(c,{label:"流程类型",prop:"definition_id"},{default:l(()=>[e(B,{modelValue:r.definition_id,"onUpdate:modelValue":a[1]||(a[1]=t=>r.definition_id=t),placeholder:"请选择流程类型",class:"modern-input"},{default:l(()=>[(m(!0),D(A,null,N(x.value,t=>(m(),M(f,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"变量名称",prop:"variable_name"},{default:l(()=>[e(z,{modelValue:r.variable_name,"onUpdate:modelValue":a[2]||(a[2]=t=>r.variable_name=t),placeholder:"请输入变量名称",class:"modern-input"},{prefix:l(()=>[e(n,null,{default:l(()=>[e(p($))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"变量键",prop:"variable_key"},{default:l(()=>[e(z,{modelValue:r.variable_key,"onUpdate:modelValue":a[3]||(a[3]=t=>r.variable_key=t),placeholder:"请输入变量键（英文）",class:"modern-input"},{prefix:l(()=>[e(n,null,{default:l(()=>[e(p(I))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"变量类型",prop:"variable_type"},{default:l(()=>[e(B,{modelValue:r.variable_type,"onUpdate:modelValue":a[4]||(a[4]=t=>r.variable_type=t),placeholder:"请选择变量类型",class:"modern-input"},{default:l(()=>[e(f,{label:"字符串",value:"string"}),e(f,{label:"数字",value:"number"}),e(f,{label:"布尔值",value:"boolean"}),e(f,{label:"数组",value:"array"}),e(f,{label:"对象",value:"object"})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"默认值",prop:"default_value"},{default:l(()=>[e(z,{modelValue:r.default_value,"onUpdate:modelValue":a[5]||(a[5]=t=>r.default_value=t),placeholder:"请输入默认值",class:"modern-input"},{prefix:l(()=>[e(n,null,{default:l(()=>[e(p(de))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"描述",prop:"description"},{default:l(()=>[e(z,{modelValue:r.description,"onUpdate:modelValue":a[6]||(a[6]=t=>r.description=t),type:"textarea",rows:3,placeholder:"请输入变量描述",class:"modern-input"},null,8,["modelValue"])]),_:1}),e(c,{label:"必填"},{default:l(()=>[e(Q,{modelValue:r.required,"onUpdate:modelValue":a[7]||(a[7]=t=>r.required=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Be=le(Ce,[["__scopeId","data-v-2c3d05bf"]]);export{Be as default};
