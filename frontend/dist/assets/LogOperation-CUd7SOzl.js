import{_ as P,s as $,o as V,c as F,b as e,w as a,E as u,r as s,p as h,n as z,$ as j,e as w,aa as R,m as _,S as A,an as G,a1 as J,i as K,a as Q,t as C,L as M}from"./index-D4Rku7DI.js";import{g as W,b as X,d as Z}from"./log-5VaKRiFa.js";import"./request-BnFmk4vl.js";import"./index-D5GkNzM3.js";const ee={class:"log-operation-container"},te={class:"duration-text"},ae={__name:"LogOperation",setup(oe){const f=h(!1),v=h([]),c=h([]),n=z({operator_account:"",operation_menu:"",start_time:"",end_time:""}),r=z({page:1,page_size:10,total:0}),d=async()=>{f.value=!0;try{const l={page:r.page,page_size:r.page_size,...n},t=await W(l);v.value=t.data,r.total=t.total}catch(l){u.error("获取操作日志失败"),console.error(l)}finally{f.value=!1}},k=()=>{r.page=1,d()},B=()=>{n.operator_account="",n.operation_menu="",n.start_time="",n.end_time="",r.page=1,d()},H=async l=>{try{await M.confirm("确定要删除这条日志吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Z(l),u.success("删除成功"),d()}catch(t){t!=="cancel"&&(u.error("删除失败"),console.error(t))}},S=async()=>{try{await M.confirm(`确定要删除选中的 ${c.value.length} 条日志吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await X(c.value),u.success("批量删除成功"),c.value=[],d()}catch(l){l!=="cancel"&&(u.error("批量删除失败"),console.error(l))}},L=l=>{c.value=l.map(t=>t.id)},U=l=>{r.page=l,d()},O=l=>{r.page_size=l,r.page=1,d()};return $(()=>{d()}),(l,t)=>{const y=s("el-input"),m=s("el-form-item"),p=s("el-col"),x=s("el-date-picker"),D=s("el-row"),b=s("el-icon"),g=s("el-button"),T=s("el-form"),Y=s("el-card"),i=s("el-table-column"),q=s("el-tag"),E=s("el-table"),I=s("el-pagination"),N=j("loading");return V(),F("div",ee,[e(Y,{class:"search-card"},{default:a(()=>[e(T,{inline:!0,model:n,class:"search-form"},{default:a(()=>[e(D,{gutter:20},{default:a(()=>[e(p,{xs:24,sm:12,md:6},{default:a(()=>[e(m,{label:"操作人账号"},{default:a(()=>[e(y,{modelValue:n.operator_account,"onUpdate:modelValue":t[0]||(t[0]=o=>n.operator_account=o),placeholder:"请输入操作人账号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{xs:24,sm:12,md:6},{default:a(()=>[e(m,{label:"操作菜单"},{default:a(()=>[e(y,{modelValue:n.operation_menu,"onUpdate:modelValue":t[1]||(t[1]=o=>n.operation_menu=o),placeholder:"请输入操作菜单",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{xs:24,sm:12,md:6},{default:a(()=>[e(m,{label:"开始时间"},{default:a(()=>[e(x,{modelValue:n.start_time,"onUpdate:modelValue":t[2]||(t[2]=o=>n.start_time=o),type:"datetime",placeholder:"选择开始时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",clearable:"",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{xs:24,sm:12,md:6},{default:a(()=>[e(m,{label:"结束时间"},{default:a(()=>[e(x,{modelValue:n.end_time,"onUpdate:modelValue":t[3]||(t[3]=o=>n.end_time=o),type:"datetime",placeholder:"选择结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",clearable:"",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(D,null,{default:a(()=>[e(p,{span:24,class:"button-group"},{default:a(()=>[e(g,{type:"primary",onClick:k},{default:a(()=>[e(b,null,{default:a(()=>[e(w(R))]),_:1}),t[6]||(t[6]=_(" 查询 ",-1))]),_:1}),e(g,{onClick:B},{default:a(()=>[e(b,null,{default:a(()=>[e(w(A))]),_:1}),t[7]||(t[7]=_(" 重置 ",-1))]),_:1}),e(g,{type:"danger",onClick:S,disabled:c.value.length===0},{default:a(()=>[e(b,null,{default:a(()=>[e(w(G))]),_:1}),t[8]||(t[8]=_(" 批量删除 ",-1))]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(Y,{class:"table-card"},{default:a(()=>[J((V(),K(E,{data:v.value,border:"",stripe:"",onSelectionChange:L},{default:a(()=>[e(i,{type:"selection",width:"55",align:"center"}),e(i,{prop:"operation_time",label:"操作时间",width:"180",align:"center"}),e(i,{prop:"operator_name",label:"操作人姓名",width:"120",align:"center"}),e(i,{prop:"operator_account",label:"操作人账号",width:"120",align:"center"}),e(i,{prop:"operation_menu",label:"操作菜单",width:"150",align:"center"}),e(i,{prop:"request_url",label:"请求接口",width:"200","show-overflow-tooltip":""}),e(i,{prop:"request_duration",label:"请求耗时",width:"100",align:"center"},{default:a(({row:o})=>[Q("span",te,C(o.request_duration?o.request_duration.toFixed(3)+"秒":"-"),1)]),_:1}),e(i,{prop:"ip_address",label:"IP地址",width:"120",align:"center"}),e(i,{prop:"status_code",label:"状态码",width:"80",align:"center"},{default:a(({row:o})=>[e(q,{type:o.status_code===200?"success":"danger"},{default:a(()=>[_(C(o.status_code),1)]),_:2},1032,["type"])]),_:1}),e(i,{label:"操作",width:"100",align:"center",fixed:"right"},{default:a(({row:o})=>[e(g,{type:"danger",size:"small",onClick:le=>H(o.id)},{default:a(()=>[...t[9]||(t[9]=[_(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[N,f.value]]),e(I,{"current-page":r.page,"onUpdate:currentPage":t[4]||(t[4]=o=>r.page=o),"page-size":r.page_size,"onUpdate:pageSize":t[5]||(t[5]=o=>r.page_size=o),"page-sizes":[10,20,50,100],total:r.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:O,onCurrentChange:U,class:"pagination"},null,8,["current-page","page-size","total"])]),_:1})])}}},de=P(ae,[["__scopeId","data-v-93c11871"]]);export{de as default};
