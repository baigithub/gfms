import{_ as Y,s as Z,o as m,c as w,b as t,w as o,r as s,p as _,n as U,$ as ee,a1 as te,i as x,m as p,t as B,a as z,e as A,am as D,L as ae,E as d}from"./index-D4Rku7DI.js";import{a as le,d as oe,u as ne,c as se}from"./announcement-f7FshZh8.js";import"./request-BnFmk4vl.js";import"./index-D5GkNzM3.js";const re={class:"system-page"},ie={class:"card-header"},de={key:1},ue=["src"],pe="/api/announcements/upload",ce={__name:"Announcement",setup(me){const k=_(!1),h=_([]),r=U({page:1,page_size:10,total:0}),c=_(!1),V=_("新增公告"),v=_(!1),C=_(null),n=U({title:"",summary:"",content:"",cover_image:"",display_order:0,is_active:!0,remarks:""}),S={Authorization:`Bearer ${localStorage.getItem("token")}`},E={title:[{required:!0,message:"请输入标题",trigger:"blur"}]},$=l=>l?new Date(l).toLocaleString("zh-CN"):"-",f=async()=>{k.value=!0;try{const l=await le({skip:(r.page-1)*r.page_size,limit:r.page_size});h.value=l||[],r.total=(l==null?void 0:l.length)||0}catch(l){console.error("Failed to load announcements:",l)}finally{k.value=!1}},M=()=>{V.value="新增公告",v.value=!1,Object.assign(n,{title:"",summary:"",content:"",cover_image:"",display_order:0,is_active:!0,remarks:""}),c.value=!0},j=l=>{V.value="编辑公告",v.value=!0,Object.assign(n,{id:l.id,title:l.title,summary:l.summary,content:l.content,cover_image:l.cover_image||"",display_order:l.display_order,is_active:l.is_active,remarks:l.remarks}),c.value=!0},F=async()=>{try{await C.value.validate(),v.value?(await ne(n.id,n),d.success("更新成功")):(await se(n),d.success("创建成功")),c.value=!1,f()}catch(l){l!==!1&&d.error(v.value?"更新失败":"创建失败")}},N=async l=>{try{await ae.confirm(`确定要删除公告 "${l.title}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await oe(l.id),d.success("删除成功"),f()}catch(e){e!=="cancel"&&d.error("删除失败")}},T=l=>{const e=l.type.startsWith("image/"),y=l.size/1024/1024<5;return e?y?!0:(d.error("图片大小不能超过 5MB!"),!1):(d.error("只能上传图片文件!"),!1)},I=l=>{n.cover_image=l.url,d.success("图片上传成功")};return Z(()=>{f()}),(l,e)=>{const y=s("el-icon"),g=s("el-button"),i=s("el-table-column"),L=s("el-image"),O=s("el-tag"),R=s("el-table"),q=s("el-pagination"),H=s("el-card"),b=s("el-input"),u=s("el-form-item"),P=s("el-upload"),W=s("el-input-number"),G=s("el-switch"),J=s("el-form"),K=s("el-dialog"),Q=ee("loading");return m(),w("div",re,[t(H,{shadow:"hover"},{header:o(()=>[z("div",ie,[e[11]||(e[11]=z("span",{class:"card-title"},"公告管理",-1)),t(g,{type:"primary",onClick:M},{default:o(()=>[t(y,null,{default:o(()=>[t(A(D))]),_:1}),e[10]||(e[10]=p(" 新增公告 ",-1))]),_:1})])]),default:o(()=>[te((m(),x(R,{data:h.value,stripe:"",style:{width:"100%"}},{default:o(()=>[t(i,{type:"index",label:"序号",width:"60"}),t(i,{prop:"title",label:"标题","min-width":"200"}),t(i,{prop:"summary",label:"摘要","min-width":"200","show-overflow-tooltip":""}),t(i,{label:"封面图片",width:"150"},{default:o(({row:a})=>[a.cover_image?(m(),x(L,{key:0,src:a.cover_image,"preview-src-list":[a.cover_image],fit:"cover",style:{width:"100px",height:"60px"}},null,8,["src","preview-src-list"])):(m(),w("span",de,"-"))]),_:1}),t(i,{prop:"display_order",label:"排序",width:"80"}),t(i,{prop:"is_active",label:"状态",width:"80"},{default:o(({row:a})=>[t(O,{type:a.is_active?"success":"danger",size:"small"},{default:o(()=>[p(B(a.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(i,{prop:"created_at",label:"创建时间",width:"180"},{default:o(({row:a})=>[p(B($(a.created_at)),1)]),_:1}),t(i,{label:"操作",width:"180",fixed:"right"},{default:o(({row:a})=>[t(g,{type:"primary",link:"",size:"small",onClick:X=>j(a)},{default:o(()=>[...e[12]||(e[12]=[p("编辑",-1)])]),_:1},8,["onClick"]),t(g,{type:"danger",link:"",size:"small",onClick:X=>N(a)},{default:o(()=>[...e[13]||(e[13]=[p("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,k.value]]),t(q,{"current-page":r.page,"onUpdate:currentPage":e[0]||(e[0]=a=>r.page=a),"page-size":r.page_size,"onUpdate:pageSize":e[1]||(e[1]=a=>r.page_size=a),total:r.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:f,onCurrentChange:f,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1}),t(K,{modelValue:c.value,"onUpdate:modelValue":e[9]||(e[9]=a=>c.value=a),title:V.value,width:"800px","close-on-click-modal":!1},{footer:o(()=>[t(g,{onClick:e[8]||(e[8]=a=>c.value=!1)},{default:o(()=>[...e[15]||(e[15]=[p("取消",-1)])]),_:1}),t(g,{type:"primary",onClick:F},{default:o(()=>[...e[16]||(e[16]=[p("确定",-1)])]),_:1})]),default:o(()=>[t(J,{model:n,rules:E,ref_key:"announcementFormRef",ref:C,"label-width":"100px"},{default:o(()=>[t(u,{label:"标题",prop:"title"},{default:o(()=>[t(b,{modelValue:n.title,"onUpdate:modelValue":e[2]||(e[2]=a=>n.title=a),placeholder:"请输入公告标题"},null,8,["modelValue"])]),_:1}),t(u,{label:"摘要",prop:"summary"},{default:o(()=>[t(b,{modelValue:n.summary,"onUpdate:modelValue":e[3]||(e[3]=a=>n.summary=a),type:"textarea",rows:2,placeholder:"请输入公告摘要"},null,8,["modelValue"])]),_:1}),t(u,{label:"正文",prop:"content"},{default:o(()=>[t(b,{modelValue:n.content,"onUpdate:modelValue":e[4]||(e[4]=a=>n.content=a),type:"textarea",rows:6,placeholder:"请输入公告正文"},null,8,["modelValue"])]),_:1}),t(u,{label:"封面图片",prop:"cover_image"},{default:o(()=>[t(P,{class:"cover-uploader",action:pe,headers:S,"show-file-list":!1,"on-success":I,"before-upload":T},{default:o(()=>[n.cover_image?(m(),w("img",{key:0,src:n.cover_image,class:"cover-image"},null,8,ue)):(m(),x(y,{key:1,class:"cover-uploader-icon"},{default:o(()=>[t(A(D))]),_:1}))]),_:1}),e[14]||(e[14]=z("div",{class:"upload-tip"},"建议上传满屏分辨率的图片 (1920x1080)",-1))]),_:1}),t(u,{label:"排序",prop:"display_order"},{default:o(()=>[t(W,{modelValue:n.display_order,"onUpdate:modelValue":e[5]||(e[5]=a=>n.display_order=a),min:0},null,8,["modelValue"])]),_:1}),t(u,{label:"状态",prop:"is_active"},{default:o(()=>[t(G,{modelValue:n.is_active,"onUpdate:modelValue":e[6]||(e[6]=a=>n.is_active=a)},null,8,["modelValue"])]),_:1}),t(u,{label:"备注",prop:"remarks"},{default:o(()=>[t(b,{modelValue:n.remarks,"onUpdate:modelValue":e[7]||(e[7]=a=>n.remarks=a),type:"textarea",rows:2,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ye=Y(ce,[["__scopeId","data-v-f069154f"]]);export{ye as default};
