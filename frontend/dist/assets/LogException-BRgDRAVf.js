import{_ as ae,u as oe,s as ne,o as k,c as se,b as e,w as t,E as f,r,p as v,n as z,$ as re,e as Y,aa as de,m as o,S as ie,an as ue,a1 as pe,i as T,t as u,j as ce,L as q}from"./index-D4Rku7DI.js";import{f as _e,h as me,i as fe,j as ve,r as ge}from"./log-5VaKRiFa.js";import"./request-BnFmk4vl.js";import"./index-D5GkNzM3.js";const be={class:"log-exception-container"},xe={__name:"LogException",setup(ye){const h=v(!1),U=v([]),g=v([]),C=v(!1),b=v(!1),s=v({}),E=v(null),P=oe(),i=z({exception_module:"",is_resolved:null,start_time:"",end_time:""}),x=z({resolved_note:""}),p=z({page:1,page_size:10,total:0}),_=async()=>{h.value=!0;try{const n={page:p.page,page_size:p.page_size,...i},l=await _e(n);U.value=l.data,p.total=l.total}catch(n){f.error("获取异常日志失败"),console.error(n)}finally{h.value=!1}},j=()=>{p.page=1,_()},N=()=>{i.exception_module="",i.is_resolved=null,i.start_time="",i.end_time="",p.page=1,_()},F=async n=>{try{const l=await fe(n.id);s.value=l,C.value=!0}catch(l){f.error("获取详情失败"),console.error(l)}},A=n=>{E.value=n.id,x.resolved_note="",b.value=!0},G=async()=>{try{await ge(E.value,{resolved_note:x.resolved_note,current_user_id:P.user.id}),f.success("标记成功"),b.value=!1,_()}catch(n){f.error("标记失败"),console.error(n)}},J=async n=>{try{await q.confirm("确定要删除这条日志吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ve(n),f.success("删除成功"),_()}catch(l){l!=="cancel"&&(f.error("删除失败"),console.error(l))}},K=async()=>{try{await q.confirm(`确定要删除选中的 ${g.value.length} 条日志吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await me(g.value),f.success("批量删除成功"),g.value=[],_()}catch(n){n!=="cancel"&&(f.error("批量删除失败"),console.error(n))}},O=n=>{g.value=n.map(l=>l.id)},Q=n=>{p.page=n,_()},W=n=>{p.page_size=n,p.page=1,_()};return ne(()=>{_()}),(n,l)=>{const V=r("el-input"),y=r("el-form-item"),w=r("el-col"),M=r("el-option"),X=r("el-select"),S=r("el-date-picker"),B=r("el-row"),D=r("el-icon"),m=r("el-button"),L=r("el-form"),H=r("el-card"),c=r("el-table-column"),$=r("el-tag"),Z=r("el-table"),ee=r("el-pagination"),d=r("el-descriptions-item"),le=r("el-descriptions"),I=r("el-dialog"),te=re("loading");return k(),se("div",be,[e(H,{class:"search-card"},{default:t(()=>[e(L,{inline:!0,model:i,class:"search-form"},{default:t(()=>[e(B,{gutter:20},{default:t(()=>[e(w,{xs:24,sm:12,md:6},{default:t(()=>[e(y,{label:"异常模块"},{default:t(()=>[e(V,{modelValue:i.exception_module,"onUpdate:modelValue":l[0]||(l[0]=a=>i.exception_module=a),placeholder:"请输入异常模块",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(w,{xs:24,sm:12,md:6},{default:t(()=>[e(y,{label:"解决状态"},{default:t(()=>[e(X,{modelValue:i.is_resolved,"onUpdate:modelValue":l[1]||(l[1]=a=>i.is_resolved=a),placeholder:"请选择解决状态",clearable:"",style:{width:"100%"}},{default:t(()=>[e(M,{label:"未解决",value:0}),e(M,{label:"已解决",value:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(w,{xs:24,sm:12,md:6},{default:t(()=>[e(y,{label:"开始时间"},{default:t(()=>[e(S,{modelValue:i.start_time,"onUpdate:modelValue":l[2]||(l[2]=a=>i.start_time=a),type:"datetime",placeholder:"选择开始时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",clearable:"",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(w,{xs:24,sm:12,md:6},{default:t(()=>[e(y,{label:"结束时间"},{default:t(()=>[e(S,{modelValue:i.end_time,"onUpdate:modelValue":l[3]||(l[3]=a=>i.end_time=a),type:"datetime",placeholder:"选择结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",clearable:"",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(B,null,{default:t(()=>[e(w,{span:24,class:"button-group"},{default:t(()=>[e(m,{type:"primary",onClick:j},{default:t(()=>[e(D,null,{default:t(()=>[e(Y(de))]),_:1}),l[12]||(l[12]=o(" 查询 ",-1))]),_:1}),e(m,{onClick:N},{default:t(()=>[e(D,null,{default:t(()=>[e(Y(ie))]),_:1}),l[13]||(l[13]=o(" 重置 ",-1))]),_:1}),e(m,{type:"danger",onClick:K,disabled:g.value.length===0},{default:t(()=>[e(D,null,{default:t(()=>[e(Y(ue))]),_:1}),l[14]||(l[14]=o(" 批量删除 ",-1))]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(H,{class:"table-card"},{default:t(()=>[pe((k(),T(Z,{data:U.value,border:"",stripe:"",onSelectionChange:O},{default:t(()=>[e(c,{type:"selection",width:"55",align:"center"}),e(c,{prop:"exception_time",label:"发生时间",width:"180",align:"center"}),e(c,{prop:"exception_module",label:"异常模块",width:"120",align:"center"}),e(c,{prop:"exception_interface",label:"异常接口",width:"200","show-overflow-tooltip":""}),e(c,{prop:"exception_type",label:"异常类型",width:"150","show-overflow-tooltip":""}),e(c,{prop:"exception_message",label:"异常消息",width:"200","show-overflow-tooltip":""}),e(c,{prop:"user_name",label:"用户姓名",width:"100",align:"center"}),e(c,{prop:"user_account",label:"用户账号",width:"120",align:"center"}),e(c,{prop:"ip_address",label:"IP地址",width:"120",align:"center"}),e(c,{prop:"is_resolved",label:"解决状态",width:"100",align:"center"},{default:t(({row:a})=>[e($,{type:a.is_resolved===1?"success":"warning"},{default:t(()=>[o(u(a.is_resolved===1?"已解决":"未解决"),1)]),_:2},1032,["type"])]),_:1}),e(c,{label:"操作",width:"260",align:"center",fixed:"right"},{default:t(({row:a})=>[e(m,{type:"primary",size:"small",onClick:R=>F(a)},{default:t(()=>[...l[15]||(l[15]=[o(" 查看详情 ",-1)])]),_:1},8,["onClick"]),a.is_resolved===0?(k(),T(m,{key:0,type:"success",size:"small",onClick:R=>A(a)},{default:t(()=>[...l[16]||(l[16]=[o(" 标记解决 ",-1)])]),_:1},8,["onClick"])):ce("",!0),e(m,{type:"danger",size:"small",onClick:R=>J(a.id)},{default:t(()=>[...l[17]||(l[17]=[o(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[te,h.value]]),e(ee,{"current-page":p.page,"onUpdate:currentPage":l[4]||(l[4]=a=>p.page=a),"page-size":p.page_size,"onUpdate:pageSize":l[5]||(l[5]=a=>p.page_size=a),"page-sizes":[10,20,50,100],total:p.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:W,onCurrentChange:Q,class:"pagination"},null,8,["current-page","page-size","total"])]),_:1}),e(I,{modelValue:C.value,"onUpdate:modelValue":l[8]||(l[8]=a=>C.value=a),title:"异常日志详情",width:"800px"},{default:t(()=>[e(le,{column:2,border:""},{default:t(()=>[e(d,{label:"异常模块"},{default:t(()=>[o(u(s.value.exception_module),1)]),_:1}),e(d,{label:"异常接口"},{default:t(()=>[o(u(s.value.exception_interface),1)]),_:1}),e(d,{label:"异常类型"},{default:t(()=>[o(u(s.value.exception_type),1)]),_:1}),e(d,{label:"异常消息"},{default:t(()=>[o(u(s.value.exception_message),1)]),_:1}),e(d,{label:"请求方法"},{default:t(()=>[o(u(s.value.request_method),1)]),_:1}),e(d,{label:"请求URL"},{default:t(()=>[o(u(s.value.request_url),1)]),_:1}),e(d,{label:"用户姓名"},{default:t(()=>[o(u(s.value.user_name),1)]),_:1}),e(d,{label:"用户账号"},{default:t(()=>[o(u(s.value.user_account),1)]),_:1}),e(d,{label:"IP地址"},{default:t(()=>[o(u(s.value.ip_address),1)]),_:1}),e(d,{label:"发生时间"},{default:t(()=>[o(u(s.value.exception_time),1)]),_:1}),e(d,{label:"解决状态"},{default:t(()=>[e($,{type:s.value.is_resolved===1?"success":"warning"},{default:t(()=>[o(u(s.value.is_resolved===1?"已解决":"未解决"),1)]),_:1},8,["type"])]),_:1}),e(d,{label:"解决时间"},{default:t(()=>[o(u(s.value.resolved_time||"-"),1)]),_:1}),e(d,{label:"堆栈信息",span:2},{default:t(()=>[e(V,{modelValue:s.value.stack_trace,"onUpdate:modelValue":l[6]||(l[6]=a=>s.value.stack_trace=a),type:"textarea",rows:10,readonly:""},null,8,["modelValue"])]),_:1}),e(d,{label:"请求参数",span:2},{default:t(()=>[e(V,{modelValue:s.value.request_params,"onUpdate:modelValue":l[7]||(l[7]=a=>s.value.request_params=a),type:"textarea",rows:5,readonly:""},null,8,["modelValue"])]),_:1}),e(d,{label:"解决备注",span:2},{default:t(()=>[o(u(s.value.resolved_note||"-"),1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(I,{modelValue:b.value,"onUpdate:modelValue":l[11]||(l[11]=a=>b.value=a),title:"标记异常为已解决",width:"500px"},{footer:t(()=>[e(m,{onClick:l[10]||(l[10]=a=>b.value=!1)},{default:t(()=>[...l[18]||(l[18]=[o("取消",-1)])]),_:1}),e(m,{type:"primary",onClick:G},{default:t(()=>[...l[19]||(l[19]=[o("确定",-1)])]),_:1})]),default:t(()=>[e(L,{model:x,"label-width":"100px"},{default:t(()=>[e(y,{label:"解决备注"},{default:t(()=>[e(V,{modelValue:x.resolved_note,"onUpdate:modelValue":l[9]||(l[9]=a=>x.resolved_note=a),type:"textarea",rows:4,placeholder:"请输入解决备注（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},De=ae(xe,[["__scopeId","data-v-3dc90dc7"]]);export{De as default};
