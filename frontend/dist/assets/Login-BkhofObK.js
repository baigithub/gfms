import{_ as D,u as B,o as V,c as F,a as o,b as s,w as n,r as p,d as O,e as c,f as v,g as S,l as T,h as U,k as E,t as x,i as I,j as K,m as R,n as q,E as m,p as _}from"./index-D4Rku7DI.js";import{l as z}from"./auth-Cf1uiXQY.js";import"./index-VufPjWZz.js";import"./index-D5GkNzM3.js";const A={class:"login-container"},G={class:"login-background"},P={class:"brand-container"},W={class:"green-logo"},j={class:"logo-circle"},H={class:"login-form-container"},J={class:"login-form"},Q={class:"form-header"},X={class:"header-icon"},Y={class:"captcha-container"},y=5e3,Z={__name:"Login",setup($){const C=O(),g=B(),w=_(null),d=_(!1),k=_("D2CIK"),h=_(0),a=q({username:"",password:"",captcha:""}),f=()=>{const i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";let e="";for(let l=0;l<5;l++)e+=i.charAt(Math.floor(Math.random()*i.length));k.value=e},L={username:[{required:!0,message:"请输入登录账号",trigger:"blur"}],password:[{required:!0,message:"请输入登录密码",trigger:"blur"}],captcha:[{required:!0,message:"请输入验证码",trigger:"blur"}]},b=async()=>{var e,l;const i=Date.now();if(i-h.value<y){const t=Math.ceil((y-(i-h.value))/1e3);m.warning(`请等待 ${t} 秒后再试`);return}try{await w.value.validate(),h.value=Date.now(),d.value=!0;const t=await z(a);g.setToken(t.access_token),g.setUser(t.user),g.setPermissions(t.user.permissions||[]),m.success("登录成功"),C.push("/")}catch(t){if(t!==!1){const r=((l=(e=t.response)==null?void 0:e.data)==null?void 0:l.detail)||t.message||"登录失败";r.includes("验证码")?(m.error("验证码错误，请重新输入"),f(),a.captcha=""):r.includes("用户名或密码错误")?(m.error("用户名或密码错误"),a.password="",f(),a.captcha=""):(m.error(r),f(),a.captcha="")}}finally{d.value=!1}};return(i,e)=>{const l=p("el-icon"),t=p("el-input"),r=p("el-form-item"),M=p("el-button"),N=p("el-form");return V(),F("div",A,[o("div",G,[e[4]||(e[4]=o("div",{class:"background-pattern"},null,-1)),o("div",P,[o("div",W,[o("div",j,[s(l,{size:56,color:"white"},{default:n(()=>[s(c(v))]),_:1})])]),e[3]||(e[3]=o("div",{class:"background-text"},[o("h1",null,"绿色金融"),o("p",null,"Green Finance Management System"),o("div",{class:"tagline"},"智能 · 高效 · 可持续")],-1))])]),o("div",H,[o("div",J,[o("div",Q,[o("div",X,[s(l,{size:32,color:"#667eea"},{default:n(()=>[s(c(v))]),_:1})]),e[5]||(e[5]=o("h2",null,"绿色金融管理系统",-1)),e[6]||(e[6]=o("p",null,"登录您的账户",-1))]),s(N,{ref_key:"loginFormRef",ref:w,model:a,rules:L,"label-position":"top",size:"large"},{default:n(()=>[s(r,{prop:"username"},{default:n(()=>[s(t,{modelValue:a.username,"onUpdate:modelValue":e[0]||(e[0]=u=>a.username=u),placeholder:"请输入登录账号","prefix-icon":c(S),class:"modern-input"},null,8,["modelValue","prefix-icon"])]),_:1}),s(r,{prop:"password"},{default:n(()=>[s(t,{modelValue:a.password,"onUpdate:modelValue":e[1]||(e[1]=u=>a.password=u),type:"password",placeholder:"请输入登录密码","prefix-icon":c(T),"show-password":"",class:"modern-input"},null,8,["modelValue","prefix-icon"])]),_:1}),s(r,{prop:"captcha"},{default:n(()=>[o("div",Y,[s(t,{modelValue:a.captcha,"onUpdate:modelValue":e[2]||(e[2]=u=>a.captcha=u),placeholder:"请输入验证码","prefix-icon":c(E),class:"modern-input captcha-input",onKeyup:U(b,["enter"])},null,8,["modelValue","prefix-icon"]),o("div",{class:"captcha-code",onClick:f,title:"点击刷新验证码"},x(k.value),1)])]),_:1}),s(r,null,{default:n(()=>[s(M,{type:"primary",loading:d.value,onClick:b,class:"login-button"},{default:n(()=>[d.value?K("",!0):(V(),I(l,{key:0,class:"button-icon"},{default:n(()=>[s(c(v))]),_:1})),R(" "+x(d.value?"登录中...":"登录"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),e[7]||(e[7]=o("div",{class:"form-footer"},[o("div",{class:"footer-divider"}),o("p",{class:"footer-text"},"© 2025 绿色金融管理系统 · 技术支持")],-1))])])])}}},ae=D(Z,[["__scopeId","data-v-155f5b53"]]);export{ae as default};
