import{_ as ne,u as oe,q as le,s as ae,o as r,c as k,b as t,w as s,a,e as l,v as re,r as d,d as ie,f as F,i as _,x as ue,j as x,F as C,y as q,m as p,t as y,z as de,A as I,B as me,C as ce,D as pe,G as _e,g as fe,H as ge,K as be,I as ye,J as T,L as he,E as B}from"./index-D4Rku7DI.js";import{u as ve}from"./tabs-DFz_k_To.js";import{a as we}from"./auth-Cf1uiXQY.js";import"./index-VufPjWZz.js";import"./index-D5GkNzM3.js";const ke={class:"layout-container"},xe={class:"logo"},Te={class:"logo-icon"},Ce={class:"main-container"},qe={class:"header-left"},Me={class:"header-right"},Be={class:"header-item"},Le={class:"user-info"},Re={class:"user-avatar"},Ae={class:"user-details"},Se={class:"user-name"},Ve={class:"user-role"},Ee={class:"tabs-container"},Pe={class:"tab-label"},ze={__name:"Layout",setup(Ne){const g=re(),M=ie(),i=oe(),c=ve(),U=T(()=>g.path),R=T(()=>g.meta.title),j={"/dashboard":"dashboard","/green-identify/pending":"green-identify-pending","/green-identify/completed":"green-identify-completed","/green-identify/archived":"green-identify-archived","/green-identify/query":"green-identify-query","/green-identify/online-report":"green-identify-query","/system/user":"system-user","/system/role":"system-role","/system/org":"system-org","/system/log/operation":"system-log-operation","/system/log/login":"system-log-login","/system/log/exception":"system-log-exception","/workflow/management":"workflow-management","/workflow/instances":"workflow-instances"},G=u=>{var n,o;const e=j[u];return((n=i.permissions)==null?void 0:n.includes(e))||((o=i.user)==null?void 0:o.is_superuser)},A=T(()=>[{path:"/green-identify/pending",label:"待办任务",permission:"green-identify-pending"},{path:"/green-identify/completed",label:"已办任务",permission:"green-identify-completed"},{path:"/green-identify/archived",label:"办结任务",permission:"green-identify-archived"},{path:"/green-identify/query",label:"综合查询",permission:"green-identify-query"},{path:"/green-identify/online-report",label:"在线报表",permission:"green-identify-query"}].filter(e=>{var n,o;return((n=i.permissions)==null?void 0:n.includes(e.permission))||((o=i.user)==null?void 0:o.is_superuser)})),S=T(()=>[{path:"/system/user",label:"用户管理",permission:"system-user"},{path:"/system/announcement",label:"公告管理",permission:"system-announcement"},{path:"/system/role",label:"角色管理",permission:"system-role"},{path:"/system/org",label:"机构管理",permission:"system-org"}].filter(e=>{var n,o;return((n=i.permissions)==null?void 0:n.includes(e.permission))||((o=i.user)==null?void 0:o.is_superuser)})),V=T(()=>[{path:"/system/log/operation",label:"操作日志",permission:"system-log-operation"},{path:"/system/log/login",label:"登录日志",permission:"system-log-login"},{path:"/system/log/exception",label:"异常日志",permission:"system-log-exception"}].filter(e=>{var n,o;return((n=i.permissions)==null?void 0:n.includes(e.permission))||((o=i.user)==null?void 0:o.is_superuser)})),E=T(()=>[{path:"/workflow/management",label:"流程管理",permission:"workflow-management"},{path:"/workflow/instances",label:"流程实例",permission:"workflow-instances"},{path:"/workflow/variables",label:"流程变量",permission:"workflow-variables"}].filter(e=>{var n,o;return((n=i.permissions)==null?void 0:n.includes(e.permission))||((o=i.user)==null?void 0:o.is_superuser)}));le(()=>g.path,u=>{u&&!g.meta.hidden&&c.addTab(g)},{immediate:!0});const K=u=>{c.removeTab(u),c.activeTab!==u&&M.push(c.activeTab)},H=u=>{const e=u.props.name,[n,o]=e.split("?");if(o){const w=new URLSearchParams(o),L=Object.fromEntries(w);M.push({path:n,query:L})}else M.push(n)},J=(u,e)=>{switch(u){case"close":c.removeTab(e);break;case"closeOthers":c.closeOtherTabs(e);break;case"closeLeft":c.closeLeftTabs(e);break;case"closeRight":c.closeRightTabs(e);break;case"closeAll":c.closeAllTabs();break}},Q=async u=>{switch(u){case"profile":B.info("个人中心功能开发中");break;case"settings":B.info("系统设置功能开发中");break;case"logout":try{await he.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await we(),i.logout(),c.closeAllTabs(),B.success("退出成功"),M.push("/login")}catch(e){e!=="cancel"&&B.error("退出失败")}break}};return ae(()=>{g.path&&!g.meta.hidden&&c.addTab(g)}),(u,e)=>{const n=d("el-icon"),o=d("el-menu-item"),w=d("el-sub-menu"),L=d("el-menu"),W=d("el-aside"),P=d("el-breadcrumb-item"),X=d("el-breadcrumb"),Y=d("el-avatar"),b=d("el-dropdown-item"),z=d("el-dropdown-menu"),N=d("el-dropdown"),Z=d("el-header"),$=d("el-tab-pane"),ee=d("el-tabs"),se=d("router-view"),te=d("el-main");return r(),k("div",ke,[t(W,{width:"240px",class:"sidebar"},{default:s(()=>[a("div",xe,[a("div",Te,[t(n,{size:28,color:"white"},{default:s(()=>[t(l(F))]),_:1})]),e[1]||(e[1]=a("div",{class:"logo-text"},[a("span",{class:"logo-title"},"绿色金融"),a("span",{class:"logo-subtitle"},"Green Finance")],-1))]),t(L,{"default-active":U.value,collapse:!1,"unique-opened":!0,router:"","background-color":"transparent","text-color":"rgba(255, 255, 255, 0.8)","active-text-color":"#ffffff"},{default:s(()=>{var m,h,O,D;return[G("/dashboard")||(m=l(i).user)!=null&&m.is_superuser?(r(),_(o,{key:0,index:"/dashboard"},{default:s(()=>[t(n,null,{default:s(()=>[t(l(ue))]),_:1}),e[2]||(e[2]=a("span",null,"首页",-1))]),_:1})):x("",!0),A.value.length>0||(h=l(i).user)!=null&&h.is_superuser?(r(),_(w,{key:1,index:"green-identify"},{title:s(()=>[t(n,null,{default:s(()=>[t(l(F))]),_:1}),e[3]||(e[3]=a("span",null,"绿色认定",-1))]),default:s(()=>[(r(!0),k(C,null,q(A.value,f=>(r(),_(o,{key:f.path,index:f.path},{default:s(()=>[p(y(f.label),1)]),_:2},1032,["index"]))),128))]),_:1})):x("",!0),S.value.length>0||(O=l(i).user)!=null&&O.is_superuser?(r(),_(w,{key:2,index:"system"},{title:s(()=>[t(n,null,{default:s(()=>[t(l(I))]),_:1}),e[4]||(e[4]=a("span",null,"系统管理",-1))]),default:s(()=>{var f;return[(r(!0),k(C,null,q(S.value,v=>(r(),_(o,{key:v.path,index:v.path},{default:s(()=>[p(y(v.label),1)]),_:2},1032,["index"]))),128)),V.value.length>0||(f=l(i).user)!=null&&f.is_superuser?(r(),_(w,{key:0,index:"log"},{title:s(()=>[t(n,null,{default:s(()=>[t(l(de))]),_:1}),e[5]||(e[5]=a("span",null,"日志管理",-1))]),default:s(()=>[(r(!0),k(C,null,q(V.value,v=>(r(),_(o,{key:v.path,index:v.path},{default:s(()=>[p(y(v.label),1)]),_:2},1032,["index"]))),128))]),_:1})):x("",!0)]}),_:1})):x("",!0),E.value.length>0||(D=l(i).user)!=null&&D.is_superuser?(r(),_(w,{key:3,index:"workflow"},{title:s(()=>[t(n,null,{default:s(()=>[t(l(me))]),_:1}),e[6]||(e[6]=a("span",null,"流程管理",-1))]),default:s(()=>[(r(!0),k(C,null,q(E.value,f=>(r(),_(o,{key:f.path,index:f.path},{default:s(()=>[p(y(f.label),1)]),_:2},1032,["index"]))),128))]),_:1})):x("",!0)]}),_:1},8,["default-active"])]),_:1}),a("div",Ce,[t(Z,{class:"header"},{default:s(()=>[a("div",qe,[t(X,{separator:"/"},{default:s(()=>[t(P,{to:"/"},{default:s(()=>[...e[7]||(e[7]=[p("首页",-1)])]),_:1}),R.value?(r(),_(P,{key:0},{default:s(()=>[p(y(R.value),1)]),_:1})):x("",!0)]),_:1})]),a("div",Me,[a("div",Be,[t(n,{size:18,color:"#667eea"},{default:s(()=>[t(l(ce))]),_:1})]),t(N,{onCommand:Q},{dropdown:s(()=>[t(z,null,{default:s(()=>[t(b,{command:"profile"},{default:s(()=>[t(n,null,{default:s(()=>[t(l(fe))]),_:1}),e[8]||(e[8]=p(" 个人中心 ",-1))]),_:1}),t(b,{command:"settings"},{default:s(()=>[t(n,null,{default:s(()=>[t(l(I))]),_:1}),e[9]||(e[9]=p(" 系统设置 ",-1))]),_:1}),t(b,{divided:"",command:"logout"},{default:s(()=>[t(n,null,{default:s(()=>[t(l(ge))]),_:1}),e[10]||(e[10]=p(" 退出登录 ",-1))]),_:1})]),_:1})]),default:s(()=>{var m,h;return[a("div",Le,[a("div",Re,[t(Y,{size:36,icon:l(pe)},null,8,["icon"])]),a("div",Ae,[a("div",Se,y((m=l(i).user)==null?void 0:m.real_name),1),a("div",Ve,y(((h=l(i).user)==null?void 0:h.role_name)||"用户"),1)]),t(n,{class:"dropdown-icon"},{default:s(()=>[t(l(_e))]),_:1})])]}),_:1})])]),_:1}),a("div",Ee,[t(ee,{modelValue:l(c).activeTab,"onUpdate:modelValue":e[0]||(e[0]=m=>l(c).activeTab=m),type:"card",closable:"",onTabRemove:K,onTabClick:H},{default:s(()=>[(r(!0),k(C,null,q(l(c).tabs,m=>(r(),_($,{key:m.path,label:m.title,name:m.path},{label:s(()=>[t(N,{trigger:"contextmenu",onCommand:h=>J(h,m.path)},{dropdown:s(()=>[t(z,null,{default:s(()=>[t(b,{command:"close"},{default:s(()=>[...e[11]||(e[11]=[p("关闭",-1)])]),_:1}),t(b,{command:"closeOthers"},{default:s(()=>[...e[12]||(e[12]=[p("关闭其他",-1)])]),_:1}),t(b,{command:"closeLeft"},{default:s(()=>[...e[13]||(e[13]=[p("关闭左侧",-1)])]),_:1}),t(b,{command:"closeRight"},{default:s(()=>[...e[14]||(e[14]=[p("关闭右侧",-1)])]),_:1}),t(b,{command:"closeAll"},{default:s(()=>[...e[15]||(e[15]=[p("关闭全部",-1)])]),_:1})]),_:1})]),default:s(()=>[a("span",Pe,y(m.title),1)]),_:2},1032,["onCommand"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),t(te,{class:"main-content"},{default:s(()=>[t(se,null,{default:s(({Component:m})=>[(r(),_(be,null,[(r(),_(ye(m),{key:l(g).fullPath}))],1024))]),_:1})]),_:1})])])}}},je=ne(ze,[["__scopeId","data-v-9c7e374a"]]);export{je as default};
