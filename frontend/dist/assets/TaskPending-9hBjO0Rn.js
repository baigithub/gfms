import{_ as E,s as G,q as N,o as v,c as V,b as t,w as s,r as c,p as k,n as q,d as F,v as Y,$,a1 as M,i as A,a as n,t as d,e as g,g as R,m as _,f as I,a3 as L,a4 as H,S as J,a2 as f}from"./index-D4Rku7DI.js";import{f as K}from"./green_finance-C_pmG5wr.js";import{u as O}from"./tabs-DFz_k_To.js";import"./index-VufPjWZz.js";import"./index-D5GkNzM3.js";const Q={class:"task-page"},W={class:"card-header"},X={class:"header-left"},Z={class:"header-right"},ee={class:"index-badge"},te={class:"customer-name"},ae={class:"amount-value"},oe={class:"date-value"},se={class:"project-category-wrap"},ne={class:"pagination-container"},le={__name:"TaskPending",setup(ie){const D=F(),w=Y(),z=O(),m=k(!1),h=k([]),i=q({page:1,page_size:10,total:0}),j=e=>e?Number(e).toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00",y=e=>e?f(e).format("YYYY-MM-DD"):"-",C=e=>{if(e.formatted_category)return e.formatted_category;const a=[];return e.project_category_large&&a.push(e.project_category_large),e.project_category_medium&&a.push(e.project_category_medium),e.project_category_small&&a.push(e.project_category_small),a.join("/")||"-"},x=e=>{if(!e)return"info";const a=f(),u=f(e).diff(a,"day");return u<0?"danger":u<=3?"warning":"success"},p=async()=>{m.value=!0;try{const e=await K({page:i.page,page_size:i.page_size});h.value=e.items,i.total=e.total}catch(e){console.error("Failed to load tasks:",e)}finally{m.value=!1}},B=e=>{console.log("DEBUG: handleView called with row:",e),console.log("DEBUG: row.customer_name:",e.customer_name),console.log("DEBUG: row.task_id:",e.task_id),console.log("DEBUG: row.identification_id:",e.identification_id);const a=`任务详情 - ${e.customer_name}`,l=`/task-detail/${e.task_id}`;console.log("DEBUG: taskPath:",l),z.addTab({path:l,title:a,query:{from:"pending"}}),D.push({path:l,query:{from:"pending"}})};return G(()=>{p()}),N(()=>w.query.t,()=>{p()}),(e,a)=>{const l=c("el-icon"),u=c("el-tag"),b=c("el-button"),r=c("el-table-column"),T=c("el-table"),P=c("el-pagination"),S=c("el-card"),U=$("loading");return v(),V("div",Q,[t(S,{shadow:"never"},{header:s(()=>[n("div",W,[n("div",X,[t(l,{class:"header-icon",color:"#667eea"},{default:s(()=>[t(g(H))]),_:1}),a[2]||(a[2]=n("span",{class:"card-title"},"待办任务",-1)),t(u,{type:"info",size:"small"},{default:s(()=>[_(d(i.total)+" 条记录",1)]),_:1})]),n("div",Z,[t(b,{onClick:p,loading:m.value},{default:s(()=>[t(l,null,{default:s(()=>[t(g(J))]),_:1}),a[3]||(a[3]=_(" 刷新 ",-1))]),_:1},8,["loading"])])])]),default:s(()=>[M((v(),A(T,{data:h.value,stripe:"","show-header":"",style:{width:"100%"},class:"modern-table"},{default:s(()=>[t(r,{type:"index",label:"序号",width:"80",align:"center"},{default:s(({$index:o})=>[n("div",ee,d(o+1),1)]),_:1}),t(r,{prop:"customer_name",label:"客户名称","min-width":"150","show-overflow-tooltip":""},{default:s(({row:o})=>[n("div",te,[t(l,null,{default:s(()=>[t(g(R))]),_:1}),_(" "+d(o.customer_name),1)])]),_:1}),t(r,{prop:"business_type",label:"业务品种",width:"150"},{default:s(({row:o})=>[t(u,{type:"primary",effect:"plain"},{default:s(()=>[_(d(o.business_type),1)]),_:2},1024)]),_:1}),t(r,{prop:"loan_account",label:"贷款账号",width:"150"}),t(r,{prop:"loan_amount",label:"放款金额(元)",width:"140",align:"right"},{default:s(({row:o})=>[n("div",ae,d(j(o.loan_amount)),1)]),_:1}),t(r,{prop:"disbursement_date",label:"放款日",width:"120",align:"center"},{default:s(({row:o})=>[n("div",oe,d(y(o.disbursement_date)),1)]),_:1}),t(r,{label:"绿色金融支持项目目录","min-width":"250"},{default:s(({row:o})=>[n("div",se,[t(l,{color:"#4CAF50"},{default:s(()=>[t(g(I))]),_:1}),n("span",null,d(C(o)),1)])]),_:1}),a[5]||(a[5]=_()),t(r,{prop:"deadline",label:"截止日期",width:"120",align:"center"},{default:s(({row:o})=>[t(u,{type:x(o.deadline),size:"small",effect:"plain"},{default:s(()=>[_(d(o.deadline?y(o.deadline):"-"),1)]),_:2},1032,["type"])]),_:1}),t(r,{label:"操作",width:"100",fixed:"right",align:"center"},{default:s(({row:o})=>[t(b,{type:"primary",link:"",onClick:re=>B(o),class:"action-button"},{default:s(()=>[t(l,null,{default:s(()=>[t(g(L))]),_:1}),a[4]||(a[4]=_(" 办理 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[U,m.value]]),n("div",ne,[t(P,{"current-page":i.page,"onUpdate:currentPage":a[0]||(a[0]=o=>i.page=o),"page-size":i.page_size,"onUpdate:pageSize":a[1]||(a[1]=o=>i.page_size=o),total:i.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:p,onCurrentChange:p},null,8,["current-page","page-size","total"])])]),_:1})])}}},ge=E(le,[["__scopeId","data-v-b6d510ee"]]);export{ge as default};
