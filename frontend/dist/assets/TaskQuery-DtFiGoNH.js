import{i as te,j as ae}from"./green_finance-B4o63B-q.js";import{_ as le,p as oe,o as m,c as V,b as e,w as t,r as d,m as z,E as U,j as $,Q as ne,i as s,S as se,s as v,t as i,a as f,F as re,y as ie,x as B}from"./index-DDrUN6p6.js";import"./index-B2NntqTq.js";import"./index-D5GkNzM3.js";const ue={class:"task-page"},de={class:"trace-header"},_e={class:"trace-title"},pe={class:"trace-detail"},ce={key:0,class:"trace-comment"},me={key:1,class:"trace-category"},fe={class:"category-value"},ge={__name:"TaskQuery",setup(ye){const x=z(!1),S=z([]),p=$({page:1,page_size:10,total:0}),o=$({customer_name:"",business_type:"",loan_account:"",loan_date_range:[],status:""}),C=z(!1),r=z({}),T=n=>n?Number(n).toLocaleString("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00",Q=n=>{if(!n)return"0 B";const a=1024,y=["B","KB","MB","GB"],c=Math.floor(Math.log(n)/Math.log(a));return Math.round(n/Math.pow(a,c)*100)/100+" "+y[c]},A=n=>{const y=`http://localhost:8000${n.download_url}`;window.open(y,"_blank")},H=n=>n==="已完成"||n==="已办结"?"success":n==="待处理"?"primary":n==="已撤回"?"info":"warning",L=()=>r.value.workflow_history&&r.value.workflow_history.length>0,G=n=>r.value.green_project_category||"",h=n=>({待处理:"warning",审核中:"primary",已办结:"success",已撤回:"info",已提交:"info",已完成:"success",驳回:"danger",办结:"success"})[n]||"info",w=async()=>{x.value=!0;try{const n={page:p.page,page_size:p.page_size};o.customer_name&&(n.customer_name=o.customer_name),o.business_type&&(n.business_type=o.business_type),o.loan_account&&(n.loan_account=o.loan_account),o.loan_date_range&&o.loan_date_range.length===2&&(n.loan_date_start=o.loan_date_range[0],n.loan_date_end=o.loan_date_range[1]),o.status&&(n.status=o.status);const a=await te(n);S.value=a.data||[],p.total=a.total||0}catch{U.error("查询失败")}finally{x.value=!1}},I=()=>{o.customer_name="",o.business_type="",o.loan_account="",o.loan_date_range=[],o.status="",p.page=1,F()},K=async()=>{try{const n={};o.customer_name&&(n.customer_name=o.customer_name),o.business_type&&(n.business_type=o.business_type),o.loan_account&&(n.loan_account=o.loan_account),o.loan_date_range&&o.loan_date_range.length===2&&(n.loan_date_start=o.loan_date_range[0],n.loan_date_end=o.loan_date_range[1]),o.status&&(n.status=o.status),await ae(n),U.success("导出成功")}catch{U.error("导出失败")}},P=n=>{r.value={...n},C.value=!0},F=async()=>{w()};return oe(()=>{F()}),(n,a)=>{const y=d("el-input"),c=d("el-form-item"),g=d("el-option"),N=d("el-select"),R=d("el-date-picker"),b=d("el-button"),q=d("el-form"),u=d("el-table-column"),k=d("el-tag"),D=d("el-table"),J=d("el-pagination"),j=d("el-card"),_=d("el-descriptions-item"),O=d("el-descriptions"),M=d("el-divider"),E=d("el-empty"),W=d("el-timeline-item"),X=d("el-timeline"),Z=d("el-dialog"),ee=ne("loading");return m(),V("div",ue,[e(j,{shadow:"hover"},{header:t(()=>[...a[8]||(a[8]=[f("div",{class:"card-header"},[f("span",{class:"card-title"},"综合查询")],-1)])]),default:t(()=>[e(q,{inline:!0,model:o,class:"search-form"},{default:t(()=>[e(c,{label:"客户名称"},{default:t(()=>[e(y,{modelValue:o.customer_name,"onUpdate:modelValue":a[0]||(a[0]=l=>o.customer_name=l),placeholder:"请输入客户名称",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(c,{label:"业务品种"},{default:t(()=>[e(N,{modelValue:o.business_type,"onUpdate:modelValue":a[1]||(a[1]=l=>o.business_type=l),placeholder:"请选择业务品种",clearable:"",style:{width:"200px"}},{default:t(()=>[e(g,{label:"一般性固定资产贷款",value:"一般性固定资产贷款"}),e(g,{label:"法人账户透支",value:"法人账户透支"}),e(g,{label:"流动资金贷款",value:"流动资金贷款"})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"贷款账号"},{default:t(()=>[e(y,{modelValue:o.loan_account,"onUpdate:modelValue":a[2]||(a[2]=l=>o.loan_account=l),placeholder:"请输入贷款账号",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(c,{label:"放款日期"},{default:t(()=>[e(R,{modelValue:o.loan_date_range,"onUpdate:modelValue":a[3]||(a[3]=l=>o.loan_date_range=l),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",clearable:"",style:{width:"300px"}},null,8,["modelValue"])]),_:1}),e(c,{label:"状态"},{default:t(()=>[e(N,{modelValue:o.status,"onUpdate:modelValue":a[4]||(a[4]=l=>o.status=l),placeholder:"请选择状态",clearable:"",style:{width:"150px"}},{default:t(()=>[e(g,{label:"待处理",value:"待处理"}),e(g,{label:"审核中",value:"审核中"}),e(g,{label:"已办结",value:"已办结"}),e(g,{label:"已撤回",value:"已撤回"})]),_:1},8,["modelValue"])]),_:1}),e(c,null,{default:t(()=>[e(b,{type:"primary",onClick:w},{default:t(()=>[...a[9]||(a[9]=[s("查询",-1)])]),_:1}),e(b,{onClick:I},{default:t(()=>[...a[10]||(a[10]=[s("重置",-1)])]),_:1}),e(b,{type:"success",onClick:K},{default:t(()=>[...a[11]||(a[11]=[s("导出",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),se((m(),v(D,{data:S.value,stripe:"",style:{width:"100%"}},{default:t(()=>[e(u,{type:"index",label:"序号",width:"60"}),e(u,{prop:"customer_name",label:"客户名称","min-width":"150"}),e(u,{prop:"business_type",label:"业务品种",width:"150"}),e(u,{prop:"loan_account",label:"贷款账号",width:"150"}),e(u,{prop:"loan_amount",label:"放款金额(元)",width:"120"},{default:t(({row:l})=>[s(i(T(l.loan_amount)),1)]),_:1}),e(u,{prop:"loan_date",label:"放款日期",width:"120"}),e(u,{prop:"status",label:"状态",width:"100"},{default:t(({row:l})=>[e(k,{type:h(l.status)},{default:t(()=>[s(i(l.status),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"assignee_name",label:"发起人",width:"120"}),e(u,{prop:"created_at",label:"创建时间",width:"160"}),e(u,{label:"操作",width:"100",fixed:"right"},{default:t(({row:l})=>[e(b,{type:"primary",link:"",size:"small",onClick:Y=>P(l)},{default:t(()=>[...a[12]||(a[12]=[s("查看",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ee,x.value]]),e(J,{"current-page":p.page,"onUpdate:currentPage":a[5]||(a[5]=l=>p.page=l),"page-size":p.page_size,"onUpdate:pageSize":a[6]||(a[6]=l=>p.page_size=l),total:p.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:w,onCurrentChange:w,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1}),e(Z,{modelValue:C.value,"onUpdate:modelValue":a[7]||(a[7]=l=>C.value=l),title:"任务详情",width:"800px","close-on-click-modal":!1},{default:t(()=>[e(O,{column:2,border:""},{default:t(()=>[e(_,{label:"任务编号"},{default:t(()=>[s(i(r.value.task_id),1)]),_:1}),e(_,{label:"任务类型"},{default:t(()=>[s(i(r.value.task_key),1)]),_:1}),e(_,{label:"客户名称"},{default:t(()=>[s(i(r.value.customer_name),1)]),_:1}),e(_,{label:"业务品种"},{default:t(()=>[s(i(r.value.business_type),1)]),_:1}),e(_,{label:"贷款账号"},{default:t(()=>[s(i(r.value.loan_account),1)]),_:1}),e(_,{label:"放款金额"},{default:t(()=>[s(i(T(r.value.loan_amount)),1)]),_:1}),e(_,{label:"放款日期"},{default:t(()=>[s(i(r.value.loan_date),1)]),_:1}),e(_,{label:"绿色金融支持项目目录"},{default:t(()=>[s(i(r.value.green_project_category),1)]),_:1}),e(_,{label:"状态"},{default:t(()=>[e(k,{type:h(r.value.status)},{default:t(()=>[s(i(r.value.status),1)]),_:1},8,["type"])]),_:1}),e(_,{label:"发起人"},{default:t(()=>[s(i(r.value.assignee_name),1)]),_:1}),e(_,{label:"创建时间"},{default:t(()=>[s(i(r.value.created_at),1)]),_:1}),e(_,{label:"完成时间"},{default:t(()=>[s(i(r.value.completed_at||"-"),1)]),_:1})]),_:1}),e(M,{"content-position":"left"},{default:t(()=>[...a[13]||(a[13]=[s("审批记录",-1)])]),_:1}),e(D,{data:r.value.workflow_history||[],stripe:"",size:"small"},{default:t(()=>[e(u,{prop:"node_name",label:"审批节点",width:"150"}),e(u,{prop:"approver_name",label:"审批人",width:"120"}),e(u,{prop:"status",label:"状态",width:"100"},{default:t(({row:l})=>[e(k,{type:h(l.status),size:"small"},{default:t(()=>[s(i(l.status),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"comment",label:"意见","min-width":"200"}),e(u,{prop:"created_at",label:"处理时间",width:"160"})]),_:1},8,["data"]),e(M,{"content-position":"left"},{default:t(()=>[...a[14]||(a[14]=[s("附件列表",-1)])]),_:1}),r.value.attachments&&r.value.attachments.length>0?(m(),v(D,{key:0,data:r.value.attachments||[],stripe:"",size:"small"},{default:t(()=>[e(u,{prop:"task_name",label:"所属节点",width:"150"}),e(u,{prop:"uploader_name",label:"上传人",width:"120"}),e(u,{prop:"original_filename",label:"附件名称","min-width":"200"},{default:t(({row:l})=>[e(b,{type:"primary",link:"",size:"small",onClick:Y=>A(l)},{default:t(()=>[s(i(l.original_filename),1)]),_:2},1032,["onClick"])]),_:1}),e(u,{prop:"file_size",label:"文件大小",width:"100"},{default:t(({row:l})=>[s(i(Q(l.file_size)),1)]),_:1}),e(u,{prop:"created_at",label:"上传时间",width:"160"})]),_:1},8,["data"])):(m(),v(E,{key:1,description:"暂无附件","image-size":60})),e(M,{"content-position":"left"},{default:t(()=>[...a[15]||(a[15]=[s("绿色分类变动轨迹",-1)])]),_:1}),e(X,null,{default:t(()=>[(m(!0),V(re,null,ie(r.value.workflow_history||[],(l,Y)=>(m(),v(W,{key:l.id,timestamp:l.created_at,placement:"top",type:H(l.status)},{default:t(()=>[e(j,{shadow:"hover",class:"trace-card"},{default:t(()=>[f("div",de,[f("span",_e,i(l.node_name),1),e(k,{size:"small",type:h(l.status)},{default:t(()=>[s(i(l.status),1)]),_:2},1032,["type"])]),f("div",pe,[f("span",null,"办理人: "+i(l.approver_name),1)]),l.comment?(m(),V("div",ce,[f("span",null,"意见: "+i(l.comment),1)])):B("",!0),L()?(m(),V("div",me,[a[16]||(a[16]=f("div",{class:"category-label"},"绿色金融支持项目目录:",-1)),f("div",fe,i(G(l.node_name)||"暂无分类信息"),1)])):B("",!0)]),_:2},1024)]),_:2},1032,["timestamp","type"]))),128))]),_:1}),!r.value.workflow_history||r.value.workflow_history.length===0?(m(),v(E,{key:2,description:"暂无分类变动轨迹"})):B("",!0)]),_:1},8,["modelValue"])])}}},ke=le(ge,[["__scopeId","data-v-6dc4c692"]]);export{ke as default};
