import{_ as O,s as R,o as v,c as V,b as e,w as t,E as m,r as _,p as y,d as A,F as G,y as H,i as B,m as i,t as u,a as c,e as p,a8 as J,a3 as K,ax as P,av as Q,j as $,au as X,an as Y,ay as Z,B as ee,am as te,f as ae,L as b}from"./index-D4Rku7DI.js";import{b as le,g as se,d as ne,e as oe,f as ie}from"./workflow-06JElo_C.js";import"./request-BnFmk4vl.js";import"./index-D5GkNzM3.js";const de={class:"workflow-management"},ce={class:"card-header"},re={class:"header-left"},ue={class:"header-right"},pe={class:"group-title"},_e={class:"group-icon"},fe={class:"group-info"},me={class:"process-name"},ve={class:"process-count"},ye={class:"workflow-name"},we={class:"date-value"},ge={class:"action-buttons"},ke={class:"node-name"},he={__name:"WorkflowManagement",setup(be){const w=A(),x=y([]),g=y([]),C=y([]),T=y([]),z=y(!1),k=async()=>{try{const l=await le({page:1,page_size:100});x.value=l||[];const a={};x.value.forEach(s=>{a[s.name]||(a[s.name]={name:s.name,versions:[]}),a[s.name].versions.push(s)}),g.value=Object.values(a).map(s=>({name:s.name,versions:s.versions.sort((r,f)=>f.version-r.version)})),g.value.length>0&&(C.value=[g.value[0].name])}catch{m.error("加载流程列表失败")}},M=()=>{w.push("/workflow/designer")},E=l=>{w.push({path:"/workflow/designer",query:{mode:"view",id:l.id}})},N=async l=>{try{const a=await se(l.id);a.instance_count&&a.instance_count>0?(await b.confirm(`当前流程版本已绑定 ${a.instance_count} 个流程实例，是否创建新版本？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info",customClass:"instance-bound-confirm"}),w.push({path:"/workflow/designer",query:{mode:"new",copyFrom:l.id}})):w.push({path:"/workflow/designer",query:{mode:"edit",id:l.id}})}catch(a){a!=="cancel"&&m.error("获取流程定义详情失败")}},W=async l=>{try{await b.confirm(`确定要删除流程 "${l.name}" 吗？此操作不可恢复。`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ie(l.id),m.success("流程删除成功"),k()}catch(a){a!=="cancel"&&m.error("流程删除失败")}},q=async l=>{try{await b.confirm(`确定要启用流程 "${l.name} v${l.version}" 吗？这将停用同一名称下的其他启用版本。`,"启用确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}),await oe(l.id),m.success("流程启用成功"),k()}catch(a){a!=="cancel"&&m.error("流程启用失败")}},F=async l=>{var a,s;try{await b.confirm(`确定要停用流程 "${l.name} v${l.version}" 吗？`,"停用确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ne(l.id),m.success("流程停用成功"),k()}catch(r){r!=="cancel"&&m.error(((s=(a=r.response)==null?void 0:a.data)==null?void 0:s.detail)||"流程停用失败")}},I=l=>({active:"已启用",archived:"已停用"})[l]||l;return R(()=>{k()}),(l,a)=>{const s=_("el-icon"),r=_("el-tag"),f=_("el-button"),d=_("el-table-column"),D=_("el-table"),j=_("el-collapse-item"),L=_("el-collapse"),S=_("el-card"),U=_("el-dialog");return v(),V("div",de,[e(S,{shadow:"never"},{header:t(()=>[c("div",ce,[c("div",re,[e(s,{class:"header-icon",color:"#667eea"},{default:t(()=>[e(p(ee))]),_:1}),a[2]||(a[2]=c("span",{class:"card-title"},"流程管理",-1)),e(r,{type:"info",size:"small"},{default:t(()=>[i(u(x.value.length)+" 个流程",1)]),_:1})]),c("div",ue,[e(f,{type:"primary",onClick:M},{default:t(()=>[e(s,null,{default:t(()=>[e(p(te))]),_:1}),a[3]||(a[3]=i(" 新建流程 ",-1))]),_:1})])])]),default:t(()=>[e(L,{modelValue:C.value,"onUpdate:modelValue":a[0]||(a[0]=n=>C.value=n),accordion:"",class:"workflow-collapse"},{default:t(()=>[(v(!0),V(G,null,H(g.value,n=>(v(),B(j,{key:n.name,name:n.name,class:"collapse-item"},{title:t(()=>[c("div",pe,[c("div",_e,[e(s,null,{default:t(()=>[e(p(Z))]),_:1})]),c("div",fe,[c("span",me,u(n.name),1),c("span",ve,u(n.versions.length)+" 个版本",1)])])]),default:t(()=>[e(D,{data:n.versions,stripe:"",class:"workflow-table"},{default:t(()=>[e(d,{prop:"id",label:"ID",width:"80",align:"center"}),e(d,{prop:"key",label:"流程键",width:"180"},{default:t(({row:o})=>[e(r,{type:"info",effect:"plain",size:"small"},{default:t(()=>[i(u(o.key),1)]),_:2},1024)]),_:1}),e(d,{prop:"name",label:"流程名称",width:"200"},{default:t(({row:o})=>[c("div",ye,[e(s,null,{default:t(()=>[e(p(J))]),_:1}),i(" "+u(o.name),1)])]),_:1}),e(d,{label:"版本",width:"100",align:"center"},{default:t(({row:o})=>[e(r,{type:"primary",effect:"plain",size:"small"},{default:t(()=>[i("v"+u(o.version),1)]),_:2},1024)]),_:1}),e(d,{prop:"description",label:"描述","min-width":"200","show-overflow-tooltip":""}),e(d,{prop:"status",label:"状态",width:"100",align:"center"},{default:t(({row:o})=>[e(r,{type:o.status==="active"?"success":"info",effect:"plain"},{default:t(()=>[i(u(I(o.status)),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"deployed_at",label:"部署时间",width:"180",align:"center"},{default:t(({row:o})=>[c("div",we,u(o.deployed_at),1)]),_:1}),e(d,{label:"操作",width:"300",fixed:"right",align:"center"},{default:t(({row:o})=>[c("div",ge,[e(f,{type:"primary",link:"",size:"small",onClick:h=>E(o)},{default:t(()=>[e(s,null,{default:t(()=>[e(p(K))]),_:1}),a[4]||(a[4]=i(" 查看 ",-1))]),_:1},8,["onClick"]),e(f,{type:"primary",link:"",size:"small",onClick:h=>N(o)},{default:t(()=>[e(s,null,{default:t(()=>[e(p(P))]),_:1}),a[5]||(a[5]=i(" 编辑 ",-1))]),_:1},8,["onClick"]),o.status==="active"?(v(),B(f,{key:0,type:"warning",link:"",size:"small",onClick:h=>F(o)},{default:t(()=>[e(s,null,{default:t(()=>[e(p(Q))]),_:1}),a[6]||(a[6]=i(" 停用 ",-1))]),_:1},8,["onClick"])):$("",!0),o.status!=="active"?(v(),B(f,{key:1,type:"success",link:"",size:"small",onClick:h=>q(o)},{default:t(()=>[e(s,null,{default:t(()=>[e(p(X))]),_:1}),a[7]||(a[7]=i(" 启用 ",-1))]),_:1},8,["onClick"])):$("",!0),e(f,{type:"danger",link:"",size:"small",onClick:h=>W(o)},{default:t(()=>[e(s,null,{default:t(()=>[e(p(Y))]),_:1}),a[8]||(a[8]=i(" 删除 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(U,{modelValue:z.value,"onUpdate:modelValue":a[1]||(a[1]=n=>z.value=n),title:"流程节点",width:"800px",class:"nodes-dialog"},{default:t(()=>[e(D,{data:T.value,stripe:"",class:"nodes-table"},{default:t(()=>[e(d,{prop:"sequence",label:"顺序",width:"80",align:"center"}),e(d,{prop:"node_id",label:"节点ID",width:"150"},{default:t(({row:n})=>[e(r,{type:"info",effect:"plain",size:"small"},{default:t(()=>[i(u(n.node_id),1)]),_:2},1024)]),_:1}),e(d,{prop:"node_name",label:"节点名称",width:"200"},{default:t(({row:n})=>[c("div",ke,[e(s,null,{default:t(()=>[e(p(ae))]),_:1}),i(" "+u(n.node_name),1)])]),_:1}),e(d,{prop:"node_type",label:"节点类型",width:"120"},{default:t(({row:n})=>[e(r,{type:"primary",effect:"plain",size:"small"},{default:t(()=>[i(u(n.node_type),1)]),_:2},1024)]),_:1}),e(d,{prop:"is_skip_if_empty",label:"无人员跳过",width:"120",align:"center"},{default:t(({row:n})=>[e(r,{type:n.is_skip_if_empty?"success":"danger",effect:"plain",size:"small"},{default:t(()=>[i(u(n.is_skip_if_empty?"是":"否"),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])])}}},De=O(he,[["__scopeId","data-v-345dd1f1"]]);export{De as default};
