import{_ as Z,p as ee,o as O,c as le,b as l,w as t,r as d,m as g,j as C,Q as ae,i as r,S as te,s as oe,t as b,a as E,e as ne,V as se,T as de,G as ie,E as y}from"./index-DDrUN6p6.js";import{b as S,i as re,j as ue,k as pe}from"./system-BEFLKTcX.js";import"./index-B2NntqTq.js";import"./index-D5GkNzM3.js";const me={class:"system-page"},ce={class:"card-header"},_e={__name:"SystemOrg",setup(fe){const z=g(!1),k=g([]),D=g([]),m=C({page:1,page_size:10,total:0}),i=C({name:"",code:""}),v=g(!1),w=g("新增机构"),V=g(!1),h=g(null),n=C({name:"",code:"",parent_id:null,level:1,address:"",is_active:!0}),T={name:[{required:!0,message:"请输入机构名称",trigger:"blur"}],code:[{required:!0,message:"请输入机构代码",trigger:"blur"}],level:[{required:!0,message:"请选择级别",trigger:"change"}]},j=o=>({1:"总行",2:"分行",3:"支行"})[o]||"-",B=o=>{if(!o)return"-";const e=k.value.find(c=>c.id===o);return e?e.name:"-"},M=o=>o?de(o).format("YYYY-MM-DD HH:mm:ss"):"-",F=o=>{const e={},c=[];return o.forEach(s=>{e[s.id]={...s,children:[]}}),o.forEach(s=>{const _=e[s.id];s.parent_id&&e[s.parent_id]?e[s.parent_id].children.push(_):c.push(_)}),c},f=async()=>{z.value=!0;try{const o={page:m.page,page_size:m.page_size};i.name&&(o.name=i.name),i.code&&(o.code=i.code);const e=await S(o);if(k.value=e.data||[],m.total=e.total||0,i.name===""&&i.code===""){const c=await S({page:1,page_size:1e3});D.value=F(c.data||[])}}catch(o){console.error("Failed to load organizations:",o)}finally{z.value=!1}},N=()=>{f()},Y=()=>{i.name="",i.code="",f()},$=()=>{w.value="新增机构",V.value=!1,Object.assign(n,{name:"",code:"",parent_id:null,level:1,address:"",is_active:!0}),v.value=!0},q=o=>{w.value="编辑机构",V.value=!0,Object.assign(n,{id:o.id,name:o.name,code:o.code,parent_id:o.parent_id,level:o.level,address:o.address,is_active:o.is_active}),v.value=!0},R=o=>{ie.confirm(`确定要删除机构 "${o.name}" 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await re(o.id),y.success("删除成功"),f()}catch{y.error("删除失败")}})},H=async()=>{h.value&&await h.value.validate(async o=>{if(o)try{V.value?(await ue(n.id,n),y.success("更新成功")):(await pe(n),y.success("创建成功")),v.value=!1,f()}catch{y.error(V.value?"更新失败":"创建失败")}})};return ee(()=>{f()}),(o,e)=>{const c=d("el-icon"),s=d("el-button"),_=d("el-input"),u=d("el-form-item"),U=d("el-form"),p=d("el-table-column"),P=d("el-tag"),A=d("el-table"),G=d("el-pagination"),L=d("el-card"),Q=d("el-tree-select"),x=d("el-option"),I=d("el-select"),J=d("el-switch"),K=d("el-dialog"),W=ae("loading");return O(),le("div",me,[l(L,{shadow:"hover"},{header:t(()=>[E("div",ce,[e[13]||(e[13]=E("span",{class:"card-title"},"机构管理",-1)),l(s,{type:"primary",onClick:$},{default:t(()=>[l(c,null,{default:t(()=>[l(ne(se))]),_:1}),e[12]||(e[12]=r(" 新增机构 ",-1))]),_:1})])]),default:t(()=>[l(U,{inline:!0,model:i,class:"search-form"},{default:t(()=>[l(u,{label:"机构名称"},{default:t(()=>[l(_,{modelValue:i.name,"onUpdate:modelValue":e[0]||(e[0]=a=>i.name=a),placeholder:"请输入机构名称",clearable:""},null,8,["modelValue"])]),_:1}),l(u,{label:"机构代码"},{default:t(()=>[l(_,{modelValue:i.code,"onUpdate:modelValue":e[1]||(e[1]=a=>i.code=a),placeholder:"请输入机构代码",clearable:""},null,8,["modelValue"])]),_:1}),l(u,null,{default:t(()=>[l(s,{type:"primary",onClick:N},{default:t(()=>[...e[14]||(e[14]=[r("查询",-1)])]),_:1}),l(s,{onClick:Y},{default:t(()=>[...e[15]||(e[15]=[r("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),te((O(),oe(A,{data:k.value,stripe:"",style:{width:"100%"}},{default:t(()=>[l(p,{type:"index",label:"序号",width:"60"}),l(p,{prop:"name",label:"机构名称",width:"200"}),l(p,{prop:"code",label:"机构代码",width:"120"}),l(p,{prop:"level",label:"机构层级",width:"120"},{default:t(({row:a})=>[r(b(a.level)+" ("+b(j(a.level))+") ",1)]),_:1}),l(p,{label:"分级机构名称",width:"150"},{default:t(({row:a})=>[r(b(B(a.parent_id)),1)]),_:1}),l(p,{prop:"address",label:"地址","min-width":"200"}),l(p,{prop:"is_active",label:"状态",width:"80"},{default:t(({row:a})=>[l(P,{type:a.is_active?"success":"danger",size:"small"},{default:t(()=>[r(b(a.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(p,{prop:"created_at",label:"创建时间",width:"180"},{default:t(({row:a})=>[r(b(M(a.created_at)),1)]),_:1}),l(p,{label:"操作",width:"150",fixed:"right"},{default:t(({row:a})=>[l(s,{type:"primary",link:"",size:"small",onClick:X=>q(a)},{default:t(()=>[...e[16]||(e[16]=[r("编辑",-1)])]),_:1},8,["onClick"]),l(s,{type:"danger",link:"",size:"small",onClick:X=>R(a)},{default:t(()=>[...e[17]||(e[17]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[W,z.value]]),l(G,{"current-page":m.page,"onUpdate:currentPage":e[2]||(e[2]=a=>m.page=a),"page-size":m.page_size,"onUpdate:pageSize":e[3]||(e[3]=a=>m.page_size=a),total:m.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:f,onCurrentChange:f,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1}),l(K,{modelValue:v.value,"onUpdate:modelValue":e[11]||(e[11]=a=>v.value=a),title:w.value,width:"600px","close-on-click-modal":!1},{footer:t(()=>[l(s,{onClick:e[10]||(e[10]=a=>v.value=!1)},{default:t(()=>[...e[18]||(e[18]=[r("取消",-1)])]),_:1}),l(s,{type:"primary",onClick:H},{default:t(()=>[...e[19]||(e[19]=[r("确定",-1)])]),_:1})]),default:t(()=>[l(U,{model:n,rules:T,ref_key:"orgFormRef",ref:h,"label-width":"100px"},{default:t(()=>[l(u,{label:"机构名称",prop:"name"},{default:t(()=>[l(_,{modelValue:n.name,"onUpdate:modelValue":e[4]||(e[4]=a=>n.name=a)},null,8,["modelValue"])]),_:1}),l(u,{label:"机构代码",prop:"code"},{default:t(()=>[l(_,{modelValue:n.code,"onUpdate:modelValue":e[5]||(e[5]=a=>n.code=a)},null,8,["modelValue"])]),_:1}),l(u,{label:"上级机构",prop:"parent_id"},{default:t(()=>[l(Q,{modelValue:n.parent_id,"onUpdate:modelValue":e[6]||(e[6]=a=>n.parent_id=a),data:D.value,props:{label:"name",value:"id",children:"children"},placeholder:"请选择上级机构","check-strictly":"",clearable:"",style:{width:"100%"}},null,8,["modelValue","data"])]),_:1}),l(u,{label:"级别",prop:"level"},{default:t(()=>[l(I,{modelValue:n.level,"onUpdate:modelValue":e[7]||(e[7]=a=>n.level=a),placeholder:"请选择级别",style:{width:"100%"}},{default:t(()=>[l(x,{label:"总行",value:1}),l(x,{label:"分行",value:2}),l(x,{label:"支行",value:3})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"地址",prop:"address"},{default:t(()=>[l(_,{modelValue:n.address,"onUpdate:modelValue":e[8]||(e[8]=a=>n.address=a)},null,8,["modelValue"])]),_:1}),l(u,{label:"状态",prop:"is_active"},{default:t(()=>[l(J,{modelValue:n.is_active,"onUpdate:modelValue":e[9]||(e[9]=a=>n.is_active=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Ve=Z(_e,[["__scopeId","data-v-8bb7485d"]]);export{Ve as default};
