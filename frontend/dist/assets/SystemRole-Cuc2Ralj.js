import{_ as X,s as Z,o as k,c as ee,b as t,w as s,O as le,r as i,p as c,$ as ae,a1 as R,i as g,m as u,t as E,j as M,a as f,e as te,am as se,ag as $,a2 as oe,E as v,L as ie,n as ne}from"./index-D4Rku7DI.js";import{a as re,e as S,f as de,h as ce}from"./system-D0KVwwem.js";import"./index-VufPjWZz.js";import"./index-D5GkNzM3.js";const ue={class:"system-page"},me={class:"card-header"},pe={class:"custom-tree-node"},fe={class:"node-label"},ve={class:"dialog-footer"},ye={class:"dialog-footer"},_e={__name:"SystemRole",setup(be){const w=c(!1),K=c([]),d=c(!1),n=c("add"),h=c(""),y=c(null),p=c(null),l=ne({id:null,name:"",description:"",permissions:[]}),r=c([]),T=[{id:1,label:"工作台",children:[{id:"dashboard",label:"首页"}]},{id:2,label:"绿色认定",children:[{id:"green-identify-pending",label:"待办任务"},{id:"green-identify-completed",label:"已办任务"},{id:"green-identify-archived",label:"办结任务"},{id:"green-identify-query",label:"综合查询"}]},{id:3,label:"系统管理",children:[{id:"system-user",label:"用户管理"},{id:"system-role",label:"角色管理"},{id:"system-org",label:"机构管理"}]},{id:4,label:"流程管理",children:[{id:"workflow-management",label:"流程管理"},{id:"workflow-instances",label:"流程实例"}]}],z={children:"children",label:"label"},N={name:[{required:!0,message:"请输入角色名称",trigger:"blur"}]},Y=a=>a?oe(a).format("YYYY-MM-DD HH:mm:ss"):"-",C=a=>a.name==="超级管理员",A=()=>{const a=[];return T.forEach(e=>{e.children&&e.children.forEach(_=>{a.push(_.id)})}),a},F=(a,e)=>{n.value==="view"&&p.value&&p.value.setCheckedKeys(r.value)},x=async()=>{w.value=!0;try{K.value=await re()}catch(a){console.error("Failed to load roles:",a)}finally{w.value=!1}},U=()=>{n.value="add",h.value="新增角色",P(),d.value=!0},j=async a=>{n.value="view",h.value="查看角色";try{r.value=[];const e=await S(a.id);l.id=e.id,l.name=e.name,l.description=e.description||"",C(e)?(r.value=A(),l.permissions=r.value):(l.permissions=e.permissions||[],r.value=l.permissions),d.value=!0}catch{v.error("获取角色详情失败")}},q=async a=>{n.value="edit",h.value="编辑角色";try{r.value=[];const e=await S(a.id);l.id=e.id,l.name=e.name,l.description=e.description||"",l.permissions=e.permissions||[],r.value=l.permissions,d.value=!0}catch{v.error("获取角色详情失败")}},H=async a=>{try{await ie.confirm(`确定要删除角色"${a.name}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await de(a.id),v.success("删除成功"),x()}catch(e){e!=="cancel"&&v.error("删除失败")}},I=async()=>{if(y.value)try{await y.value.validate();const e=p.value.getCheckedKeys().filter(_=>typeof _=="string");l.permissions=e,console.log("提交的权限:",l.permissions),await ce(l.id,l),v.success("保存成功"),d.value=!1,x()}catch(a){a!==!1&&v.error("保存失败")}},P=()=>{l.id=null,l.name="",l.description="",l.permissions=[],r.value=[],y.value&&y.value.resetFields(),p.value&&p.value.setCheckedKeys([])};return Z(()=>{x()}),(a,e)=>{const _=i("el-icon"),m=i("el-button"),b=i("el-table-column"),L=i("el-table"),O=i("el-card"),B=i("el-input"),V=i("el-form-item"),G=i("el-tree"),J=i("el-form"),Q=i("el-dialog"),W=ae("loading");return k(),ee("div",ue,[t(O,{shadow:"hover"},{header:s(()=>[f("div",me,[e[6]||(e[6]=f("span",{class:"card-title"},"角色管理",-1)),t(m,{type:"primary",size:"small",onClick:U},{default:s(()=>[t(_,null,{default:s(()=>[t(te(se))]),_:1}),e[5]||(e[5]=u(" 新增角色 ",-1))]),_:1})])]),default:s(()=>[R((k(),g(L,{data:K.value,stripe:"",style:{width:"100%"}},{default:s(()=>[t(b,{type:"index",label:"序号",width:"60"}),t(b,{prop:"name",label:"角色名称",width:"150"}),t(b,{prop:"description",label:"描述","min-width":"200"}),t(b,{prop:"created_at",label:"创建时间",width:"180"},{default:s(({row:o})=>[u(E(Y(o.created_at)),1)]),_:1}),t(b,{label:"操作",width:"200",fixed:"right"},{default:s(({row:o})=>[t(m,{type:"primary",link:"",size:"small",onClick:D=>j(o)},{default:s(()=>[...e[7]||(e[7]=[u(" 查看 ",-1)])]),_:1},8,["onClick"]),C(o)?M("",!0):(k(),g(m,{key:0,type:"primary",link:"",size:"small",onClick:D=>q(o)},{default:s(()=>[...e[8]||(e[8]=[u(" 编辑 ",-1)])]),_:1},8,["onClick"])),C(o)?M("",!0):(k(),g(m,{key:1,type:"danger",link:"",size:"small",onClick:D=>H(o)},{default:s(()=>[...e[9]||(e[9]=[u(" 删除 ",-1)])]),_:1},8,["onClick"]))]),_:1})]),_:1},8,["data"])),[[W,w.value]])]),_:1}),t(Q,{modelValue:d.value,"onUpdate:modelValue":e[4]||(e[4]=o=>d.value=o),title:h.value,width:"600px","close-on-click-modal":!1,class:le({"view-mode":n.value==="view"})},{footer:s(()=>[R(f("div",ve,[t(m,{onClick:e[2]||(e[2]=o=>d.value=!1)},{default:s(()=>[...e[10]||(e[10]=[u("取消",-1)])]),_:1}),t(m,{type:"primary",onClick:I},{default:s(()=>[...e[11]||(e[11]=[u("确定",-1)])]),_:1})],512),[[$,n.value!=="view"]]),R(f("div",ye,[t(m,{onClick:e[3]||(e[3]=o=>d.value=!1)},{default:s(()=>[...e[12]||(e[12]=[u("关闭",-1)])]),_:1})],512),[[$,n.value==="view"]])]),default:s(()=>[t(J,{ref_key:"formRef",ref:y,model:l,rules:N,"label-width":"100px",disabled:n.value==="view"},{default:s(()=>[t(V,{label:"角色名称",prop:"name"},{default:s(()=>[t(B,{modelValue:l.name,"onUpdate:modelValue":e[0]||(e[0]=o=>l.name=o),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),t(V,{label:"描述",prop:"description"},{default:s(()=>[t(B,{modelValue:l.description,"onUpdate:modelValue":e[1]||(e[1]=o=>l.description=o),type:"textarea",rows:3,placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),t(V,{label:"菜单权限",prop:"permissions"},{default:s(()=>[(k(),g(G,{ref_key:"permissionTreeRef",ref:p,data:T,props:z,"node-key":"id","show-checkbox":"",key:l.id||"new","default-checked-keys":r.value,"default-expanded-keys":[1,2,3],"default-expand-all":!0,"check-strictly":n.value==="view",onCheck:F},{default:s(({node:o,data:D})=>[f("span",pe,[f("span",fe,E(o.label),1)])]),_:1},8,["default-checked-keys","check-strictly"]))]),_:1})]),_:1},8,["model","disabled"])]),_:1},8,["modelValue","title","class"])])}}},Ce=X(_e,[["__scopeId","data-v-4077c273"]]);export{Ce as default};
