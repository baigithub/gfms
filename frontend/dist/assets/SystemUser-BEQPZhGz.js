import{_ as Z,p as ee,o as m,c as x,b as a,w as o,r as s,m as u,j as D,Q as le,S as ae,s as V,i as p,t as C,a as E,e as te,V as oe,F as N,y as j,x as ne,G as se,E as b}from"./index-DDrUN6p6.js";import{g as re,a as ie,b as de,d as ue,u as pe,c as me}from"./system-BEFLKTcX.js";import"./index-B2NntqTq.js";import"./index-D5GkNzM3.js";const _e={class:"system-page"},ce={class:"card-header"},ge={__name:"SystemUser",setup(fe){const w=u(!1),h=u([]),z=u([]),U=u([]),d=D({page:1,page_size:10,total:0}),_=u(!1),k=u("新增用户"),c=u(!1),F=u(null),n=D({username:"",password:"",real_name:"",employee_id:"",email:"",phone:"",role_id:null,org_id:null,is_active:!0}),O={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],real_name:[{required:!0,message:"请输入姓名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},R=t=>{const e=z.value.find(v=>v.id===t);return e?e.name:"-"},T=t=>{const e=U.value.find(v=>v.id===t);return e?e.name:"-"},f=async()=>{w.value=!0;try{const t=await re({page:d.page,page_size:d.page_size});h.value=t,d.total=t.length}catch(t){console.error("Failed to load users:",t)}finally{w.value=!1}},$=async()=>{try{z.value=await ie()}catch(t){console.error("Failed to load roles:",t)}},q=async()=>{try{const t=await de();U.value=t.data||[]}catch(t){console.error("Failed to load organizations:",t)}},M=()=>{k.value="新增用户",c.value=!1,Object.assign(n,{username:"",password:"",real_name:"",employee_id:"",email:"",phone:"",role_id:null,org_id:null,is_active:!0}),_.value=!0},A=t=>{k.value="编辑用户",c.value=!0,Object.assign(n,{id:t.id,username:t.username,real_name:t.real_name,employee_id:t.employee_id,email:t.email,phone:t.phone,role_id:t.role_id,is_active:t.is_active}),_.value=!0},G=async()=>{try{await F.value.validate(),c.value?(await pe(n.id,n),b.success("更新成功")):(await me(n),b.success("创建成功")),_.value=!1,f()}catch(t){t!==!1&&b.error(c.value?"更新失败":"创建失败")}},I=async t=>{try{await se.confirm(`确定要删除用户 ${t.real_name} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ue(t.id),b.success("删除成功"),f()}catch(e){e!=="cancel"&&b.error("删除失败")}};return ee(()=>{f(),$(),q()}),(t,e)=>{const v=s("el-icon"),y=s("el-button"),r=s("el-table-column"),L=s("el-tag"),P=s("el-table"),Q=s("el-pagination"),H=s("el-card"),g=s("el-input"),i=s("el-form-item"),B=s("el-option"),S=s("el-select"),J=s("el-switch"),K=s("el-form"),W=s("el-dialog"),X=le("loading");return m(),x("div",_e,[a(H,{shadow:"hover"},{header:o(()=>[E("div",ce,[e[14]||(e[14]=E("span",{class:"card-title"},"用户管理",-1)),a(y,{type:"primary",onClick:M},{default:o(()=>[a(v,null,{default:o(()=>[a(te(oe))]),_:1}),e[13]||(e[13]=p(" 新增用户 ",-1))]),_:1})])]),default:o(()=>[ae((m(),V(P,{data:h.value,stripe:"",style:{width:"100%"}},{default:o(()=>[a(r,{type:"index",label:"序号",width:"60"}),a(r,{prop:"username",label:"用户名",width:"120"}),a(r,{prop:"real_name",label:"姓名",width:"100"}),a(r,{prop:"employee_id",label:"工号",width:"120"}),a(r,{prop:"email",label:"邮箱","min-width":"150"}),a(r,{prop:"phone",label:"电话",width:"120"}),a(r,{prop:"org_id",label:"所属机构",width:"150"},{default:o(({row:l})=>[p(C(T(l.org_id)),1)]),_:1}),a(r,{prop:"role_id",label:"角色",width:"100"},{default:o(({row:l})=>[p(C(R(l.role_id)),1)]),_:1}),a(r,{prop:"is_active",label:"状态",width:"80"},{default:o(({row:l})=>[a(L,{type:l.is_active?"success":"danger",size:"small"},{default:o(()=>[p(C(l.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(r,{label:"操作",width:"150",fixed:"right"},{default:o(({row:l})=>[a(y,{type:"primary",link:"",size:"small",onClick:Y=>A(l)},{default:o(()=>[...e[15]||(e[15]=[p("编辑",-1)])]),_:1},8,["onClick"]),a(y,{type:"danger",link:"",size:"small",onClick:Y=>I(l)},{default:o(()=>[...e[16]||(e[16]=[p("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[X,w.value]]),a(Q,{"current-page":d.page,"onUpdate:currentPage":e[0]||(e[0]=l=>d.page=l),"page-size":d.page_size,"onUpdate:pageSize":e[1]||(e[1]=l=>d.page_size=l),total:d.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:f,onCurrentChange:f,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1}),a(W,{modelValue:_.value,"onUpdate:modelValue":e[12]||(e[12]=l=>_.value=l),title:k.value,width:"600px","close-on-click-modal":!1},{footer:o(()=>[a(y,{onClick:e[11]||(e[11]=l=>_.value=!1)},{default:o(()=>[...e[17]||(e[17]=[p("取消",-1)])]),_:1}),a(y,{type:"primary",onClick:G},{default:o(()=>[...e[18]||(e[18]=[p("确定",-1)])]),_:1})]),default:o(()=>[a(K,{model:n,rules:O,ref_key:"userFormRef",ref:F,"label-width":"100px"},{default:o(()=>[a(i,{label:"用户名",prop:"username"},{default:o(()=>[a(g,{modelValue:n.username,"onUpdate:modelValue":e[2]||(e[2]=l=>n.username=l),disabled:c.value},null,8,["modelValue","disabled"])]),_:1}),a(i,{label:"姓名",prop:"real_name"},{default:o(()=>[a(g,{modelValue:n.real_name,"onUpdate:modelValue":e[3]||(e[3]=l=>n.real_name=l)},null,8,["modelValue"])]),_:1}),a(i,{label:"工号",prop:"employee_id"},{default:o(()=>[a(g,{modelValue:n.employee_id,"onUpdate:modelValue":e[4]||(e[4]=l=>n.employee_id=l)},null,8,["modelValue"])]),_:1}),a(i,{label:"邮箱",prop:"email"},{default:o(()=>[a(g,{modelValue:n.email,"onUpdate:modelValue":e[5]||(e[5]=l=>n.email=l)},null,8,["modelValue"])]),_:1}),a(i,{label:"电话",prop:"phone"},{default:o(()=>[a(g,{modelValue:n.phone,"onUpdate:modelValue":e[6]||(e[6]=l=>n.phone=l)},null,8,["modelValue"])]),_:1}),a(i,{label:"角色",prop:"role_id"},{default:o(()=>[a(S,{modelValue:n.role_id,"onUpdate:modelValue":e[7]||(e[7]=l=>n.role_id=l),placeholder:"请选择角色",style:{width:"100%"}},{default:o(()=>[(m(!0),x(N,null,j(z.value,l=>(m(),V(B,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"所属机构",prop:"org_id"},{default:o(()=>[a(S,{modelValue:n.org_id,"onUpdate:modelValue":e[8]||(e[8]=l=>n.org_id=l),placeholder:"请选择机构",style:{width:"100%"}},{default:o(()=>[(m(!0),x(N,null,j(U.value,l=>(m(),V(B,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"状态",prop:"is_active"},{default:o(()=>[a(J,{modelValue:n.is_active,"onUpdate:modelValue":e[9]||(e[9]=l=>n.is_active=l)},null,8,["modelValue"])]),_:1}),c.value?ne("",!0):(m(),V(i,{key:0,label:"密码",prop:"password"},{default:o(()=>[a(g,{modelValue:n.password,"onUpdate:modelValue":e[10]||(e[10]=l=>n.password=l),type:"password"},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},we=Z(ge,[["__scopeId","data-v-bfb5a943"]]);export{we as default};
