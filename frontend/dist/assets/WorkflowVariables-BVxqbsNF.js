import{r as q,b as P}from"./workflow-DQgkmHMg.js";import{_ as X,p as Y,o as _,c as T,b as l,w as o,E as v,r as n,m as y,j as D,Q as ee,F as j,y as E,s as h,S as le,i as m,t as F,x as ae,a as $,G as te}from"./index-DDrUN6p6.js";import"./index-D5GkNzM3.js";function oe(s){return q.get("/workflow-variables",{params:s})}function re(s){return q.post("/workflow-variables",s)}function ne(s,b){return q.put(`/workflow-variables/${s}`,b)}function ie(s){return q.delete(`/workflow-variables/${s}`)}const de={class:"workflow-variables"},se={class:"card-header"},ue={__name:"WorkflowVariables",setup(s){const b=y(!1),c=y(!1),g=y("add"),M=y(null),w=y([]),x=y([]),f=D({workflowType:""}),r=D({definition_id:"",variable_name:"",variable_key:"",variable_type:"string",default_value:"",description:"",required:!1}),z={definition_id:[{required:!0,message:"请选择流程类型",trigger:"change"}],variable_name:[{required:!0,message:"请输入变量名称",trigger:"blur"}],variable_key:[{required:!0,message:"请输入变量键",trigger:"blur"},{pattern:/^[a-zA-Z_][a-zA-Z0-9_]*$/,message:"变量键只能包含字母、数字和下划线，且必须以字母或下划线开头",trigger:"blur"}],variable_type:[{required:!0,message:"请选择变量类型",trigger:"change"}]},A=async()=>{try{const t=await P({page:1,page_size:100}),e=new Map;t&&t.length>0?(t.forEach(i=>{(!e.has(i.name)||i.version>e.get(i.name).version)&&e.set(i.name,i)}),w.value=Array.from(e.values())):w.value=[]}catch(t){console.error("加载流程定义失败:",t)}},V=async()=>{b.value=!0;try{const t={};f.workflowType&&(t.definition_id=f.workflowType);const e=await oe(t);x.value=e||[]}catch(t){console.error("加载流程变量失败:",t),v.error("加载流程变量失败")}finally{b.value=!1}},N=()=>{g.value="add",Object.assign(r,{definition_id:f.workflowType||"",variable_name:"",variable_key:"",variable_type:"string",default_value:"",description:"",required:!1}),c.value=!0},S=t=>{g.value="edit",Object.assign(r,{id:t.id,definition_id:t.definition_id,variable_name:t.variable_name,variable_key:t.variable_key,variable_type:t.variable_type,default_value:t.default_value,description:t.description,required:t.required}),c.value=!0},I=t=>{te.confirm("确定要删除该流程变量吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await ie(t.id),v.success("删除成功"),V()}catch(e){console.error("删除失败:",e),v.error("删除失败")}}).catch(()=>{})},O=async()=>{try{await M.value.validate();const t={...r};g.value==="edit"?(await ne(t.id,t),v.success("更新成功")):(await re(t),v.success("创建成功")),c.value=!1,V()}catch(t){t!==!1&&(console.error("提交失败:",t),v.error("提交失败"))}},R=t=>({string:"字符串",number:"数字",boolean:"布尔值",array:"数组",object:"对象"})[t]||t,W=t=>({string:"",number:"success",boolean:"warning",array:"info",object:"danger"})[t]||"";return Y(()=>{A(),V()}),(t,e)=>{const i=n("el-button"),p=n("el-option"),C=n("el-select"),u=n("el-form-item"),U=n("el-form"),d=n("el-table-column"),B=n("el-tag"),Z=n("el-table"),G=n("el-empty"),L=n("el-card"),k=n("el-input"),Q=n("el-switch"),H=n("el-dialog"),J=ee("loading");return _(),T("div",de,[l(L,null,{header:o(()=>[$("div",se,[e[11]||(e[11]=$("span",null,"流程变量管理",-1)),l(i,{type:"primary",onClick:N},{default:o(()=>[...e[10]||(e[10]=[m("新建变量",-1)])]),_:1})])]),default:o(()=>[l(U,{inline:!0,model:f},{default:o(()=>[l(u,{label:"流程类型"},{default:o(()=>[l(C,{modelValue:f.workflowType,"onUpdate:modelValue":e[0]||(e[0]=a=>f.workflowType=a),placeholder:"请选择流程类型",clearable:"",style:{width:"200px"},onChange:V},{default:o(()=>[(_(!0),T(j,null,E(w.value,a=>(_(),h(p,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"]),le((_(),h(Z,{data:x.value,stripe:""},{default:o(()=>[l(d,{prop:"id",label:"ID",width:"80"}),l(d,{prop:"definition_name",label:"流程类型",width:"200"}),l(d,{prop:"variable_name",label:"变量名称",width:"180"}),l(d,{prop:"variable_key",label:"变量键",width:"180"}),l(d,{prop:"variable_type",label:"变量类型",width:"120"},{default:o(({row:a})=>[l(B,{type:W(a.variable_type)},{default:o(()=>[m(F(R(a.variable_type)),1)]),_:2},1032,["type"])]),_:1}),l(d,{prop:"default_value",label:"默认值",width:"150"}),l(d,{prop:"description",label:"描述"}),l(d,{prop:"required",label:"必填",width:"80"},{default:o(({row:a})=>[l(B,{type:a.required?"success":"info"},{default:o(()=>[m(F(a.required?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),l(d,{label:"操作",width:"180",fixed:"right"},{default:o(({row:a})=>[l(i,{type:"primary",link:"",size:"small",onClick:K=>S(a)},{default:o(()=>[...e[12]||(e[12]=[m("编辑",-1)])]),_:1},8,["onClick"]),l(i,{type:"danger",link:"",size:"small",onClick:K=>I(a)},{default:o(()=>[...e[13]||(e[13]=[m("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[J,b.value]]),!b.value&&x.value.length===0?(_(),h(G,{key:0,description:"暂无流程变量"})):ae("",!0)]),_:1}),l(H,{modelValue:c.value,"onUpdate:modelValue":e[9]||(e[9]=a=>c.value=a),title:g.value==="add"?"新建流程变量":"编辑流程变量",width:"600px"},{footer:o(()=>[l(i,{onClick:e[8]||(e[8]=a=>c.value=!1)},{default:o(()=>[...e[14]||(e[14]=[m("取消",-1)])]),_:1}),l(i,{type:"primary",onClick:O},{default:o(()=>[...e[15]||(e[15]=[m("确定",-1)])]),_:1})]),default:o(()=>[l(U,{model:r,rules:z,ref_key:"variableFormRef",ref:M,"label-width":"100px"},{default:o(()=>[l(u,{label:"流程类型",prop:"definition_id"},{default:o(()=>[l(C,{modelValue:r.definition_id,"onUpdate:modelValue":e[1]||(e[1]=a=>r.definition_id=a),placeholder:"请选择流程类型",style:{width:"100%"}},{default:o(()=>[(_(!0),T(j,null,E(w.value,a=>(_(),h(p,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"变量名称",prop:"variable_name"},{default:o(()=>[l(k,{modelValue:r.variable_name,"onUpdate:modelValue":e[2]||(e[2]=a=>r.variable_name=a),placeholder:"请输入变量名称"},null,8,["modelValue"])]),_:1}),l(u,{label:"变量键",prop:"variable_key"},{default:o(()=>[l(k,{modelValue:r.variable_key,"onUpdate:modelValue":e[3]||(e[3]=a=>r.variable_key=a),placeholder:"请输入变量键（英文）"},null,8,["modelValue"])]),_:1}),l(u,{label:"变量类型",prop:"variable_type"},{default:o(()=>[l(C,{modelValue:r.variable_type,"onUpdate:modelValue":e[4]||(e[4]=a=>r.variable_type=a),placeholder:"请选择变量类型",style:{width:"100%"}},{default:o(()=>[l(p,{label:"字符串",value:"string"}),l(p,{label:"数字",value:"number"}),l(p,{label:"布尔值",value:"boolean"}),l(p,{label:"数组",value:"array"}),l(p,{label:"对象",value:"object"})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"默认值",prop:"default_value"},{default:o(()=>[l(k,{modelValue:r.default_value,"onUpdate:modelValue":e[5]||(e[5]=a=>r.default_value=a),placeholder:"请输入默认值"},null,8,["modelValue"])]),_:1}),l(u,{label:"描述",prop:"description"},{default:o(()=>[l(k,{modelValue:r.description,"onUpdate:modelValue":e[6]||(e[6]=a=>r.description=a),type:"textarea",rows:3,placeholder:"请输入变量描述"},null,8,["modelValue"])]),_:1}),l(u,{label:"必填"},{default:o(()=>[l(Q,{modelValue:r.required,"onUpdate:modelValue":e[7]||(e[7]=a=>r.required=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},be=X(ue,[["__scopeId","data-v-a55d60cb"]]);export{be as default};
