import{_ as L,u as D,o as M,c as N,a,b as t,w as n,r as u,d as B,e as m,f as E,g as F,l as O,h as T,k as U,t as I,i as K,j as R,E as d,m as f}from"./index-DDrUN6p6.js";import{l as S}from"./auth-CeISuAVf.js";import"./index-B2NntqTq.js";import"./index-D5GkNzM3.js";const q={class:"login-container"},A={class:"login-background"},G={class:"green-logo"},z={class:"login-form-container"},P={class:"login-form"},W={class:"captcha-container"},y=5e3,j={__name:"Login",setup(H){const V=B(),_=D(),v=f(null),g=f(!1),w=f("D2CIK"),h=f(0),s=R({username:"",password:"",captcha:""}),p=()=>{const i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";let e="";for(let r=0;r<5;r++)e+=i.charAt(Math.floor(Math.random()*i.length));w.value=e},k={username:[{required:!0,message:"请输入登录账号",trigger:"blur"}],password:[{required:!0,message:"请输入登录密码",trigger:"blur"}],captcha:[{required:!0,message:"请输入验证码",trigger:"blur"}]},x=async()=>{var e,r;const i=Date.now();if(i-h.value<y){const o=Math.ceil((y-(i-h.value))/1e3);d.warning(`请等待 ${o} 秒后再试`);return}try{await v.value.validate(),h.value=Date.now(),g.value=!0;const o=await S(s);_.setToken(o.access_token),_.setUser(o.user),_.setPermissions(o.user.permissions||[]),d.success("登录成功"),V.push("/")}catch(o){if(o!==!1){const l=((r=(e=o.response)==null?void 0:e.data)==null?void 0:r.detail)||o.message;l.includes("验证码")?(d.error("验证码错误，请重新输入"),p(),s.captcha=""):l.includes("用户名或密码错误")?(d.error("用户名或密码错误"),s.password="",p(),s.captcha=""):(d.error(l||"登录失败"),p(),s.captcha="")}}finally{g.value=!1}};return(i,e)=>{const r=u("el-icon"),o=u("el-input"),l=u("el-form-item"),b=u("el-button"),C=u("el-form");return M(),N("div",q,[a("div",A,[a("div",G,[t(r,{size:60,color:"#2E8B57"},{default:n(()=>[t(m(E))]),_:1})]),e[3]||(e[3]=a("div",{class:"background-text"},[a("h1",null,"绿色金融"),a("p",null,"Green Finance")],-1))]),a("div",z,[a("div",P,[e[5]||(e[5]=a("div",{class:"form-header"},[a("h2",null,"绿色金融管理系统")],-1)),t(C,{ref_key:"loginFormRef",ref:v,model:s,rules:k,"label-position":"top",size:"large"},{default:n(()=>[t(l,{prop:"username"},{default:n(()=>[t(o,{modelValue:s.username,"onUpdate:modelValue":e[0]||(e[0]=c=>s.username=c),placeholder:"请输入登录账号","prefix-icon":m(F)},null,8,["modelValue","prefix-icon"])]),_:1}),t(l,{prop:"password"},{default:n(()=>[t(o,{modelValue:s.password,"onUpdate:modelValue":e[1]||(e[1]=c=>s.password=c),type:"password",placeholder:"请输入登录密码","prefix-icon":m(O),"show-password":""},null,8,["modelValue","prefix-icon"])]),_:1}),t(l,{prop:"captcha"},{default:n(()=>[a("div",W,[t(o,{modelValue:s.captcha,"onUpdate:modelValue":e[2]||(e[2]=c=>s.captcha=c),placeholder:"请输入验证码","prefix-icon":m(U),style:{flex:"1"},onKeyup:T(x,["enter"])},null,8,["modelValue","prefix-icon"]),a("div",{class:"captcha-code",onClick:p,title:"点击刷新验证码"},I(w.value),1)])]),_:1}),t(l,null,{default:n(()=>[t(b,{type:"primary",loading:g.value,onClick:x,style:{width:"100%"}},{default:n(()=>[...e[4]||(e[4]=[K(" 登录 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])])])}}},Z=L(j,[["__scopeId","data-v-9d479365"]]);export{Z as default};
