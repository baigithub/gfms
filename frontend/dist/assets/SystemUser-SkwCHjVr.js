import{_ as le,s as ae,o as _,c as z,b as a,w as o,r as i,p as m,n as I,$ as te,a1 as oe,i as w,m as d,t as x,a as $,e as ne,am as ie,F as E,y as N,j as se,L as R,E as c}from"./index-D4Rku7DI.js";import{g as re,a as de,b as ue,r as pe,d as me,u as _e,c as ce}from"./system-D0KVwwem.js";import"./index-VufPjWZz.js";import"./index-D5GkNzM3.js";const ge={class:"system-page"},fe={class:"card-header"},ve={__name:"SystemUser",setup(ye){const V=m(!1),C=m([]),h=m([]),U=m([]),u=I({page:1,page_size:10,total:0}),g=m(!1),k=m("新增用户"),f=m(!1),D=m(null),n=I({username:"",password:"",real_name:"",employee_id:"",email:"",phone:"",wechat_openid:"",wechat_unionid:"",role_id:null,org_id:null,is_active:!0}),S={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],real_name:[{required:!0,message:"请输入姓名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},T=t=>{const e=h.value.find(b=>b.id===t);return e?e.name:"-"},j=t=>{const e=U.value.find(b=>b.id===t);return e?e.name:"-"},y=async()=>{V.value=!0;try{const t=await re({page:u.page,page_size:u.page_size});C.value=t,u.total=t.length}catch(t){console.error("Failed to load users:",t)}finally{V.value=!1}},q=async()=>{try{h.value=await de()}catch(t){console.error("Failed to load roles:",t)}},M=async()=>{try{const t=await ue();U.value=t.data||[]}catch(t){console.error("Failed to load organizations:",t)}},P=()=>{k.value="新增用户",f.value=!1,Object.assign(n,{username:"",password:"",real_name:"",employee_id:"",email:"",phone:"",wechat_openid:"",wechat_unionid:"",role_id:null,org_id:null,is_active:!0}),g.value=!0},L=t=>{k.value="编辑用户",f.value=!0,Object.assign(n,{id:t.id,username:t.username,real_name:t.real_name,employee_id:t.employee_id,email:t.email,phone:t.phone,wechat_openid:t.wechat_openid||"",wechat_unionid:t.wechat_unionid||"",role_id:t.role_id,org_id:t.org_id,is_active:t.is_active}),g.value=!0},A=async()=>{try{await D.value.validate(),f.value?(await _e(n.id,n),c.success("更新成功")):(await ce(n),c.success("创建成功")),g.value=!1,y()}catch(t){t!==!1&&c.error(f.value?"更新失败":"创建失败")}},G=async t=>{try{await R.confirm(`确定要删除用户 ${t.real_name} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await me(t.id),c.success("删除成功"),y()}catch(e){e!=="cancel"&&c.error("删除失败")}},H=async t=>{try{await R.confirm(`确定要将用户 ${t.real_name} 的密码重置为 123456 吗？`,"重置密码",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await pe(t.id),c.success("密码重置成功，新密码为：123456")}catch(e){e!=="cancel"&&c.error("密码重置失败")}};return ae(()=>{y(),q(),M()}),(t,e)=>{const b=i("el-icon"),v=i("el-button"),s=i("el-table-column"),J=i("el-tag"),K=i("el-table"),Q=i("el-pagination"),W=i("el-card"),p=i("el-input"),r=i("el-form-item"),B=i("el-option"),F=i("el-select"),X=i("el-switch"),Y=i("el-form"),Z=i("el-dialog"),ee=te("loading");return _(),z("div",ge,[a(W,{shadow:"hover"},{header:o(()=>[$("div",fe,[e[16]||(e[16]=$("span",{class:"card-title"},"用户管理",-1)),a(v,{type:"primary",onClick:P},{default:o(()=>[a(b,null,{default:o(()=>[a(ne(ie))]),_:1}),e[15]||(e[15]=d(" 新增用户 ",-1))]),_:1})])]),default:o(()=>[oe((_(),w(K,{data:C.value,stripe:"",style:{width:"100%"}},{default:o(()=>[a(s,{type:"index",label:"序号",width:"60"}),a(s,{prop:"username",label:"用户名",width:"120"}),a(s,{prop:"real_name",label:"姓名",width:"100"}),a(s,{prop:"employee_id",label:"工号",width:"120"}),a(s,{prop:"email",label:"邮箱","min-width":"150"}),a(s,{prop:"phone",label:"电话",width:"120"}),a(s,{prop:"wechat_openid",label:"微信OpenID",width:"180"}),a(s,{prop:"wechat_unionid",label:"微信UnionID",width:"180"}),a(s,{prop:"org_id",label:"所属机构",width:"150"},{default:o(({row:l})=>[d(x(j(l.org_id)),1)]),_:1}),a(s,{prop:"role_id",label:"角色",width:"100"},{default:o(({row:l})=>[d(x(T(l.role_id)),1)]),_:1}),a(s,{prop:"is_active",label:"状态",width:"80"},{default:o(({row:l})=>[a(J,{type:l.is_active?"success":"danger",size:"small"},{default:o(()=>[d(x(l.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(s,{label:"操作",width:"220",fixed:"right"},{default:o(({row:l})=>[a(v,{type:"primary",link:"",size:"small",onClick:O=>L(l)},{default:o(()=>[...e[17]||(e[17]=[d("编辑",-1)])]),_:1},8,["onClick"]),a(v,{type:"warning",link:"",size:"small",onClick:O=>H(l)},{default:o(()=>[...e[18]||(e[18]=[d("重置密码",-1)])]),_:1},8,["onClick"]),a(v,{type:"danger",link:"",size:"small",onClick:O=>G(l)},{default:o(()=>[...e[19]||(e[19]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ee,V.value]]),a(Q,{"current-page":u.page,"onUpdate:currentPage":e[0]||(e[0]=l=>u.page=l),"page-size":u.page_size,"onUpdate:pageSize":e[1]||(e[1]=l=>u.page_size=l),total:u.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:y,onCurrentChange:y,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"])]),_:1}),a(Z,{modelValue:g.value,"onUpdate:modelValue":e[14]||(e[14]=l=>g.value=l),title:k.value,width:"600px","close-on-click-modal":!1},{footer:o(()=>[a(v,{onClick:e[13]||(e[13]=l=>g.value=!1)},{default:o(()=>[...e[20]||(e[20]=[d("取消",-1)])]),_:1}),a(v,{type:"primary",onClick:A},{default:o(()=>[...e[21]||(e[21]=[d("确定",-1)])]),_:1})]),default:o(()=>[a(Y,{model:n,rules:S,ref_key:"userFormRef",ref:D,"label-width":"100px"},{default:o(()=>[a(r,{label:"用户名",prop:"username"},{default:o(()=>[a(p,{modelValue:n.username,"onUpdate:modelValue":e[2]||(e[2]=l=>n.username=l),disabled:f.value},null,8,["modelValue","disabled"])]),_:1}),a(r,{label:"姓名",prop:"real_name"},{default:o(()=>[a(p,{modelValue:n.real_name,"onUpdate:modelValue":e[3]||(e[3]=l=>n.real_name=l)},null,8,["modelValue"])]),_:1}),a(r,{label:"工号",prop:"employee_id"},{default:o(()=>[a(p,{modelValue:n.employee_id,"onUpdate:modelValue":e[4]||(e[4]=l=>n.employee_id=l)},null,8,["modelValue"])]),_:1}),a(r,{label:"邮箱",prop:"email"},{default:o(()=>[a(p,{modelValue:n.email,"onUpdate:modelValue":e[5]||(e[5]=l=>n.email=l)},null,8,["modelValue"])]),_:1}),a(r,{label:"电话",prop:"phone"},{default:o(()=>[a(p,{modelValue:n.phone,"onUpdate:modelValue":e[6]||(e[6]=l=>n.phone=l)},null,8,["modelValue"])]),_:1}),a(r,{label:"微信OpenID",prop:"wechat_openid"},{default:o(()=>[a(p,{modelValue:n.wechat_openid,"onUpdate:modelValue":e[7]||(e[7]=l=>n.wechat_openid=l),placeholder:"请输入微信OpenID"},null,8,["modelValue"])]),_:1}),a(r,{label:"微信UnionID",prop:"wechat_unionid"},{default:o(()=>[a(p,{modelValue:n.wechat_unionid,"onUpdate:modelValue":e[8]||(e[8]=l=>n.wechat_unionid=l),placeholder:"请输入微信UnionID"},null,8,["modelValue"])]),_:1}),a(r,{label:"角色",prop:"role_id"},{default:o(()=>[a(F,{modelValue:n.role_id,"onUpdate:modelValue":e[9]||(e[9]=l=>n.role_id=l),placeholder:"请选择角色",style:{width:"100%"}},{default:o(()=>[(_(!0),z(E,null,N(h.value,l=>(_(),w(B,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(r,{label:"所属机构",prop:"org_id"},{default:o(()=>[a(F,{modelValue:n.org_id,"onUpdate:modelValue":e[10]||(e[10]=l=>n.org_id=l),placeholder:"请选择机构",style:{width:"100%"}},{default:o(()=>[(_(!0),z(E,null,N(U.value,l=>(_(),w(B,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(r,{label:"状态",prop:"is_active"},{default:o(()=>[a(X,{modelValue:n.is_active,"onUpdate:modelValue":e[11]||(e[11]=l=>n.is_active=l)},null,8,["modelValue"])]),_:1}),f.value?se("",!0):(_(),w(r,{key:0,label:"密码",prop:"password"},{default:o(()=>[a(p,{modelValue:n.password,"onUpdate:modelValue":e[12]||(e[12]=l=>n.password=l),type:"password"},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Ue=le(ve,[["__scopeId","data-v-a9d6bb1b"]]);export{Ue as default};
