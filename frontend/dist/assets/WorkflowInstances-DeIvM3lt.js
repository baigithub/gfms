import{_ as q,s as A,o as B,c as H,b as e,w as t,E as z,r as c,p as b,a as i,e as f,g as J,m as s,t as o,z as K,a8 as O,a3 as Q,an as R,i as X,j as Y,B as ee,S as ae,Z as te,f as le,D as ne,L as se}from"./index-D4Rku7DI.js";import{h as oe,i as ie,j as de,k as ce,l as ue,m as re}from"./workflow-06JElo_C.js";import"./request-BnFmk4vl.js";import"./index-D5GkNzM3.js";const _e={class:"workflow-instances"},pe={class:"card-header"},fe={class:"header-left"},me={class:"header-right"},ge={class:"customer-name"},ve={class:"loan-account"},be={class:"workflow-name"},he={class:"date-value"},we={class:"date-value"},ye={class:"action-buttons"},ke={class:"pagination-container"},ze={class:"instance-detail-content"},xe={class:"divider-title"},Ce={class:"task-name"},Ve={class:"assignee-name"},Te={class:"date-value"},Ie={class:"date-value"},Me={__name:"WorkflowInstances",setup(Se){const y=b([]),r=b({page:1,page_size:20,total:0}),V=b([]),k=b(""),w=b("green_finance"),x=b(!1),m=b(null),g=async()=>{try{const n={page:r.value.page,page_size:r.value.page_size};k.value&&(n.status=k.value);let l;w.value==="green_finance"?l=await oe(n):l=await ie(n),y.value=l.data||[],r.value.total=l.total||0}catch(n){console.error("Failed to load instances:",n),z.error("加载实例列表失败")}},F=async n=>{m.value=n;try{let l;w.value==="green_finance"?l=await de(n.id):l=await ce(n.id),V.value=l||[],x.value=!0}catch(l){console.error("Failed to load tasks:",l),z.error("加载任务记录失败")}},D=async n=>{try{await se.confirm(`确定要删除流程实例 "${n.instance_key}" 吗？此操作不可恢复。`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),w.value==="green_finance"?await ue(n.id):await re(n.id),z.success("流程实例删除成功"),g()}catch(l){l!=="cancel"&&z.error("流程实例删除失败")}},U=n=>{r.value.page=n,g()},E=n=>{r.value.page_size=n,r.value.page=1,g()},T=n=>({running:"warning",completed:"success",terminated:"danger",returned:"warning",withdrawn:"info",assigned:"primary",已办结:"success"})[n]||"",I=n=>({running:"审批中",completed:"已完成",terminated:"已终止",returned:"退回",withdrawn:"撤回",assigned:"分配",已办结:"已办结"})[n]||n,N=n=>({pending:"warning",completed:"success",skipped:"info",cancelled:"danger"})[n]||"",j=n=>({pending:"待处理",completed:"已完成",skipped:"已跳过",cancelled:"已取消"})[n]||n;return A(()=>{g()}),(n,l)=>{const _=c("el-icon"),v=c("el-tag"),p=c("el-option"),M=c("el-select"),C=c("el-button"),d=c("el-table-column"),S=c("el-table"),G=c("el-pagination"),$=c("el-empty"),P=c("el-card"),h=c("el-descriptions-item"),W=c("el-descriptions"),L=c("el-divider"),Z=c("el-dialog");return B(),H("div",_e,[e(P,{shadow:"never"},{header:t(()=>[i("div",pe,[i("div",fe,[e(_,{class:"header-icon",color:"#667eea"},{default:t(()=>[e(f(ee))]),_:1}),l[5]||(l[5]=i("span",{class:"card-title"},"流程实例",-1)),e(v,{type:"info",size:"small"},{default:t(()=>[s(o(y.value.length)+" 个实例",1)]),_:1})]),i("div",me,[e(M,{modelValue:w.value,"onUpdate:modelValue":l[0]||(l[0]=a=>w.value=a),placeholder:"工作流类型",class:"modern-select",onChange:g},{default:t(()=>[e(p,{label:"通用工作流",value:"general"}),e(p,{label:"绿色金融工作流",value:"green_finance"})]),_:1},8,["modelValue"]),e(M,{modelValue:k.value,"onUpdate:modelValue":l[1]||(l[1]=a=>k.value=a),placeholder:"状态",class:"modern-select",onChange:g},{default:t(()=>[e(p,{label:"全部",value:""}),e(p,{label:"审批中",value:"running"}),e(p,{label:"已完成",value:"completed"}),e(p,{label:"已终止",value:"terminated"}),e(p,{label:"退回",value:"returned"}),e(p,{label:"撤回",value:"withdrawn"}),e(p,{label:"分配",value:"assigned"}),e(p,{label:"已办结",value:"已办结"})]),_:1},8,["modelValue"]),e(C,{onClick:g},{default:t(()=>[e(_,null,{default:t(()=>[e(f(ae))]),_:1}),l[6]||(l[6]=s(" 刷新 ",-1))]),_:1})])])]),default:t(()=>[e(S,{data:y.value,stripe:"",class:"modern-table"},{default:t(()=>[e(d,{prop:"customer_name",label:"客户名称",width:"150"},{default:t(({row:a})=>[i("div",ge,[e(_,null,{default:t(()=>[e(f(J))]),_:1}),s(" "+o(a.customer_name),1)])]),_:1}),e(d,{prop:"loan_account",label:"贷款账号",width:"180"},{default:t(({row:a})=>[i("div",ve,[e(_,null,{default:t(()=>[e(f(K))]),_:1}),s(" "+o(a.loan_account),1)])]),_:1}),e(d,{prop:"instance_key",label:"实例键",width:"150"},{default:t(({row:a})=>[e(v,{type:"info",effect:"plain",size:"small"},{default:t(()=>[s(o(a.instance_key),1)]),_:2},1024)]),_:1}),e(d,{prop:"business_key",label:"业务键",width:"150"},{default:t(({row:a})=>[e(v,{type:"primary",effect:"plain",size:"small"},{default:t(()=>[s(o(a.business_key),1)]),_:2},1024)]),_:1}),e(d,{prop:"definition.name",label:"流程名称",width:"200"},{default:t(({row:a})=>{var u;return[i("div",be,[e(_,null,{default:t(()=>[e(f(O))]),_:1}),s(" "+o((u=a.definition)==null?void 0:u.name),1)])]}),_:1}),e(d,{label:"流程版本",width:"100",align:"center"},{default:t(({row:a})=>[e(v,{type:"success",effect:"plain",size:"small"},{default:t(()=>{var u;return[s("v"+o((u=a.definition)==null?void 0:u.version),1)]}),_:2},1024)]),_:1}),e(d,{prop:"status",label:"状态",width:"100",align:"center"},{default:t(({row:a})=>[e(v,{type:T(a.status),effect:"plain",size:"small"},{default:t(()=>[s(o(I(a.status)),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"started_at",label:"开始时间",width:"180",align:"center"},{default:t(({row:a})=>[i("div",he,o(a.started_at),1)]),_:1}),e(d,{prop:"completed_at",label:"完成时间",width:"180",align:"center"},{default:t(({row:a})=>[i("div",we,o(a.completed_at||"-"),1)]),_:1}),e(d,{label:"操作",width:"200",fixed:"right",align:"center"},{default:t(({row:a})=>[i("div",ye,[e(C,{type:"primary",link:"",size:"small",onClick:u=>F(a)},{default:t(()=>[e(_,null,{default:t(()=>[e(f(Q))]),_:1}),l[7]||(l[7]=s(" 查看详情 ",-1))]),_:1},8,["onClick"]),e(C,{type:"danger",link:"",size:"small",onClick:u=>D(a)},{default:t(()=>[e(_,null,{default:t(()=>[e(f(R))]),_:1}),l[8]||(l[8]=s(" 删除 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"]),i("div",ke,[e(G,{"current-page":r.value.page,"onUpdate:currentPage":l[2]||(l[2]=a=>r.value.page=a),"page-size":r.value.page_size,"onUpdate:pageSize":l[3]||(l[3]=a=>r.value.page_size=a),"page-sizes":[10,20,50,100],total:r.value.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:E,onCurrentChange:U,small:""},null,8,["current-page","page-size","total"])]),y.value.length===0?(B(),X($,{key:0,description:"暂无流程实例"})):Y("",!0)]),_:1}),e(Z,{modelValue:x.value,"onUpdate:modelValue":l[4]||(l[4]=a=>x.value=a),title:"实例详情",width:"900px",class:"instance-dialog"},{default:t(()=>[i("div",ze,[e(W,{column:2,border:"",class:"detail-descriptions"},{default:t(()=>[e(h,{label:"实例键"},{default:t(()=>{var a;return[s(o((a=m.value)==null?void 0:a.instance_key),1)]}),_:1}),e(h,{label:"业务键"},{default:t(()=>{var a;return[s(o((a=m.value)==null?void 0:a.business_key),1)]}),_:1}),e(h,{label:"流程名称"},{default:t(()=>{var a,u;return[s(o((u=(a=m.value)==null?void 0:a.definition)==null?void 0:u.name),1)]}),_:1}),e(h,{label:"状态"},{default:t(()=>{var a;return[e(v,{type:T((a=m.value)==null?void 0:a.status),effect:"plain"},{default:t(()=>{var u;return[s(o(I((u=m.value)==null?void 0:u.status)),1)]}),_:1},8,["type"])]}),_:1}),e(h,{label:"开始时间"},{default:t(()=>{var a;return[s(o((a=m.value)==null?void 0:a.started_at),1)]}),_:1}),e(h,{label:"完成时间"},{default:t(()=>{var a;return[s(o(((a=m.value)==null?void 0:a.completed_at)||"-"),1)]}),_:1})]),_:1}),e(L,{"content-position":"left"},{default:t(()=>[i("span",xe,[e(_,null,{default:t(()=>[e(f(te))]),_:1}),l[9]||(l[9]=s(" 任务记录 ",-1))])]),_:1}),e(S,{data:V.value,stripe:"",size:"small",class:"tasks-table"},{default:t(()=>[e(d,{prop:"task_name",label:"任务名称",width:"200"},{default:t(({row:a})=>[i("div",Ce,[e(_,null,{default:t(()=>[e(f(le))]),_:1}),s(" "+o(a.task_name),1)])]),_:1}),e(d,{prop:"assignee_name",label:"处理人",width:"120"},{default:t(({row:a})=>[i("div",Ve,[e(_,null,{default:t(()=>[e(f(ne))]),_:1}),s(" "+o(a.assignee_name),1)])]),_:1}),e(d,{prop:"status",label:"状态",width:"100",align:"center"},{default:t(({row:a})=>[e(v,{type:N(a.status),effect:"plain",size:"small"},{default:t(()=>[s(o(j(a.status)),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"started_at",label:"开始时间",width:"180",align:"center"},{default:t(({row:a})=>[i("div",Te,o(a.started_at),1)]),_:1}),e(d,{prop:"completed_at",label:"完成时间",width:"180",align:"center"},{default:t(({row:a})=>[i("div",Ie,o(a.completed_at||"-"),1)]),_:1}),e(d,{prop:"comment",label:"处理意见","min-width":"200","show-overflow-tooltip":""})]),_:1},8,["data"])])]),_:1},8,["modelValue"])])}}},Ee=q(Me,[["__scopeId","data-v-0abfe24f"]]);export{Ee as default};
