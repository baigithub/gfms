import{h as N,i as U,j as $,k as W,l as j}from"./workflow-DQgkmHMg.js";import{_ as L,p as R,o as q,c as A,b as e,w as l,E as v,r as i,m as _,i as o,t as u,a as h,G as H}from"./index-DDrUN6p6.js";import"./index-D5GkNzM3.js";const J={class:"workflow-instances"},K={class:"card-header"},O={__name:"WorkflowInstances",setup(P){const b=_([]),x=_([]),g=_(""),m=_("general"),w=_(!1),p=_(null),f=async()=>{try{const n={page:1,page_size:100};g.value&&(n.status=g.value),console.log("Loading instances:",m.value,n);let a;m.value==="green_finance"?a=await N(n):a=await U(n),console.log("Response:",a),b.value=a.data||[],console.log("Instances loaded:",b.value.length)}catch(n){console.error("Failed to load instances:",n),v.error("加载实例列表失败")}},C=async n=>{p.value=n;try{const a=await $(n.id);x.value=a||[],w.value=!0}catch{v.error("加载任务记录失败")}},B=async n=>{try{await H.confirm(`确定要删除流程实例 "${n.instance_key}" 吗？此操作不可恢复。`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),m.value==="green_finance"?await W(n.id):await j(n.id),v.success("流程实例删除成功"),f()}catch(a){a!=="cancel"&&v.error("流程实例删除失败")}},V=n=>({running:"warning",completed:"success",terminated:"danger",returned:"warning",withdrawn:"info",assigned:"primary",已办结:"success"})[n]||"",I=n=>({running:"审批中",completed:"已完成",terminated:"已终止",returned:"退回",withdrawn:"撤回",assigned:"分配",已办结:"已办结"})[n]||n,z=n=>({pending:"warning",completed:"success",skipped:"info",cancelled:"danger"})[n]||"",S=n=>({pending:"待处理",completed:"已完成",skipped:"已跳过",cancelled:"已取消"})[n]||n;return R(()=>{f()}),(n,a)=>{const d=i("el-option"),M=i("el-select"),y=i("el-button"),s=i("el-table-column"),k=i("el-tag"),T=i("el-table"),D=i("el-card"),c=i("el-descriptions-item"),E=i("el-descriptions"),F=i("el-divider"),G=i("el-dialog");return q(),A("div",J,[e(D,null,{header:l(()=>[h("div",K,[a[4]||(a[4]=h("span",null,"流程实例",-1)),h("div",null,[e(M,{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=t=>m.value=t),placeholder:"工作流类型",style:{width:"150px","margin-right":"10px"},onChange:f},{default:l(()=>[e(d,{label:"通用工作流",value:"general"}),e(d,{label:"绿色金融工作流",value:"green_finance"})]),_:1},8,["modelValue"]),e(M,{modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=t=>g.value=t),placeholder:"状态",style:{width:"120px","margin-right":"10px"},onChange:f},{default:l(()=>[e(d,{label:"全部",value:""}),e(d,{label:"审批中",value:"running"}),e(d,{label:"已完成",value:"completed"}),e(d,{label:"已终止",value:"terminated"}),e(d,{label:"退回",value:"returned"}),e(d,{label:"撤回",value:"withdrawn"}),e(d,{label:"分配",value:"assigned"}),e(d,{label:"已办结",value:"已办结"})]),_:1},8,["modelValue"]),e(y,{onClick:f},{default:l(()=>[...a[3]||(a[3]=[o("刷新",-1)])]),_:1})])])]),default:l(()=>[e(T,{data:b.value,stripe:""},{default:l(()=>[e(s,{prop:"instance_key",label:"实例键",width:"200"}),e(s,{prop:"business_key",label:"业务键",width:"200"}),e(s,{prop:"definition.name",label:"流程名称",width:"200"}),e(s,{label:"流程版本",width:"100"},{default:l(({row:t})=>{var r;return[o(" v"+u((r=t.definition)==null?void 0:r.version),1)]}),_:1}),e(s,{prop:"status",label:"状态",width:"100"},{default:l(({row:t})=>[e(k,{type:V(t.status)},{default:l(()=>[o(u(I(t.status)),1)]),_:2},1032,["type"])]),_:1}),e(s,{prop:"started_at",label:"开始时间",width:"180"}),e(s,{prop:"completed_at",label:"完成时间",width:"180"}),e(s,{label:"操作",width:"200",fixed:"right"},{default:l(({row:t})=>[e(y,{type:"primary",link:"",size:"small",onClick:r=>C(t)},{default:l(()=>[...a[5]||(a[5]=[o("查看详情",-1)])]),_:1},8,["onClick"]),e(y,{type:"danger",link:"",size:"small",onClick:r=>B(t)},{default:l(()=>[...a[6]||(a[6]=[o("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(G,{modelValue:w.value,"onUpdate:modelValue":a[2]||(a[2]=t=>w.value=t),title:"实例详情",width:"900px"},{default:l(()=>[e(E,{column:2,border:""},{default:l(()=>[e(c,{label:"实例键"},{default:l(()=>{var t;return[o(u((t=p.value)==null?void 0:t.instance_key),1)]}),_:1}),e(c,{label:"业务键"},{default:l(()=>{var t;return[o(u((t=p.value)==null?void 0:t.business_key),1)]}),_:1}),e(c,{label:"流程名称"},{default:l(()=>{var t,r;return[o(u((r=(t=p.value)==null?void 0:t.definition)==null?void 0:r.name),1)]}),_:1}),e(c,{label:"状态"},{default:l(()=>{var t;return[e(k,{type:V((t=p.value)==null?void 0:t.status)},{default:l(()=>{var r;return[o(u(I((r=p.value)==null?void 0:r.status)),1)]}),_:1},8,["type"])]}),_:1}),e(c,{label:"开始时间"},{default:l(()=>{var t;return[o(u((t=p.value)==null?void 0:t.started_at),1)]}),_:1}),e(c,{label:"完成时间"},{default:l(()=>{var t;return[o(u(((t=p.value)==null?void 0:t.completed_at)||"-"),1)]}),_:1})]),_:1}),e(F,{"content-position":"left"},{default:l(()=>[...a[7]||(a[7]=[o("任务记录",-1)])]),_:1}),e(T,{data:x.value,stripe:"",size:"small"},{default:l(()=>[e(s,{prop:"task_name",label:"任务名称",width:"200"}),e(s,{prop:"assignee_name",label:"处理人",width:"120"}),e(s,{prop:"status",label:"状态",width:"100"},{default:l(({row:t})=>[e(k,{type:z(t.status),size:"small"},{default:l(()=>[o(u(S(t.status)),1)]),_:2},1032,["type"])]),_:1}),e(s,{prop:"started_at",label:"开始时间",width:"180"}),e(s,{prop:"completed_at",label:"完成时间",width:"180"}),e(s,{prop:"comment",label:"处理意见","min-width":"200"})]),_:1},8,["data"])]),_:1},8,["modelValue"])])}}},Z=L(O,[["__scopeId","data-v-f7589cc9"]]);export{Z as default};
